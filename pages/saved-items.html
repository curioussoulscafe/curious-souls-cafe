<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Curious Souls Caf√© - Saved Items (Questions & Actions)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
  <style>
    :root { --highlight-color: #57FCFF; }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #f3f4f6 0%, #ede9fe 20%, #ede9fe 80%, #f3f4f6 100%);
    }

    .topic-card {
      background-color: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
    }

    .question-chip, .action-chip {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      background-color: #f8fafc;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 0.9rem 0.9rem;
      transition: background 0.15s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.15s;
      cursor: pointer;
      margin-bottom: 0.5rem;
    }
    .question-chip:hover, .action-chip:hover {
      background-color: #eef2ff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .selected-chip {
      background-color: var(--highlight-color);
      transform: scale(1.02);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .question-text, .action-text {
      font-size: 1rem;
      color: #111827;
    }
    .question-actions button, .action-actions button {
      border-radius: 9999px;
      padding: 0.35rem 0.6rem;
      font-size: 0.85rem;
      font-weight: 600;
      transition: transform 0.1s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    .question-actions button:active, .action-actions button:active {
      transform: scale(0.98);
    }

    .pill {
      border: 1px solid #d1d5db;
      background-color: #ffffff;
      color: #4b5563;
      font-weight: 600;
      border-radius: 9999px;
      padding: 0.4rem 0.75rem;
      font-size: 0.9rem;
      transition: background 0.15s, color 0.15s, border-color 0.15s, box-shadow 0.15s;
    }
    .pill:hover { background-color: #f3f4f6; }
    .danger { background-color: #fee2e2; color: #991b1b; border-color: #fecaca; }
    .danger:hover { background-color: #fecaca; }
    .primary { background-color: #8b5cf6; color: #ffffff; border-color: #8b5cf6; }
    .primary:hover { background-color: #7c3aed; }
    .muted { background-color: #f3f4f6; color: #374151; border-color: #e5e7eb; }
    .muted:hover { background-color: #e5e7eb; }

    .section-title { color: #6b46c1; }
    .subtle { color: #6b7280; }

    .empty-state {
      background: #f8fafc;
      border: 1px dashed #d1d5db;
      padding: 1rem;
      border-radius: 0.75rem;
      color: #6b7280;
      text-align: center;
    }

    .search-input {
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      padding: 0.6rem 0.8rem;
      width: 100%;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .search-input:focus {
      border-color: #8b5cf6;
      box-shadow: 0 0 0 3px rgba(139,92,246,0.25);
    }

    .badge {
      background: #ede9fe;
      color: #6b46c1;
      border-radius: 9999px;
      padding: 0.2rem 0.55rem;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .toolbar {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid #e5e7eb;
    }

    /* Floating buttons */
    #back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #6b46c1;
      color: white;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 9999px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      display: none;
      transition: opacity 0.3s ease-in-out, transform 0.15s ease-in-out;
      z-index: 1000;
    }
    #back-to-top:hover { background-color: #805ad5; transform: translateY(-2px); }

    #floating-dice, #floating-lookup, #floating-share {
      position: fixed;
      right: 20px;
      width: 56px; height: 56px;
      border-radius: 9999px;
      color: #ffffff;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
      text-decoration: none;
      transition: transform 0.15s ease-in-out, box-shadow 0.2s ease-in-out, filter 0.2s;
    }
    #floating-dice {
      bottom: 80px;
      background: linear-gradient(135deg, #10b981, #06b6d4);
      z-index: 1100;
    }
    #floating-dice:hover, #floating-dice:focus { transform: translateY(-2px) scale(1.03); box-shadow: 0 10px 18px rgba(0,0,0,0.2); outline: none; filter: brightness(1.05); }
    #floating-dice .fa-dice { font-size: 1.4rem; }

    #floating-lookup {
      bottom: 148px;
      background: linear-gradient(135deg, #3b82f6, #10b981);
      display: none;
      z-index: 1150;
      cursor: pointer;
    }
    #floating-lookup i { font-size: 1.25rem; }
    #floating-lookup:hover, #floating-lookup:focus { transform: translateY(-2px) scale(1.03); box-shadow: 0 10px 18px rgba(0,0,0,0.2); outline: none; filter: brightness(1.05); }

    #floating-share {
      bottom: 214px;
      background: linear-gradient(135deg, #a855f7, #ec4899);
      display: none;
      z-index: 1130;
      cursor: pointer;
    }
    #floating-share i { font-size: 1.15rem; }
    #floating-share:hover, #floating-share:focus { transform: translateY(-2px) scale(1.03); box-shadow: 0 10px 18px rgba(0,0,0,0.2); outline: none; filter: brightness(1.05); }

    @media (max-width: 480px) {
      #floating-dice { width: 52px; height: 52px; bottom: 76px; right: 16px; }
      #floating-dice .fa-dice { font-size: 1.25rem; }
      #back-to-top { bottom: 16px; right: 16px; }
      #floating-lookup { width: 52px; height: 52px; right: 16px; bottom: 140px; }
      #floating-lookup i { font-size: 1.15rem; }
      #floating-share { width: 52px; height: 52px; right: 16px; bottom: 204px; }
      #floating-share i { font-size: 1.05rem; }
    }

    /* Modal system */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
      display: flex; justify-content: center; align-items: center;
      z-index: 2000;
      opacity: 0; visibility: hidden;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    .modal-overlay.show { opacity: 1; visibility: visible; }
    .modal-content {
      background-color: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: 0 10px 15px rgba(0,0,0,0.2);
      text-align: center;
      max-width: 360px; width: 90%;
      transform: translateY(-20px);
      transition: transform 0.3s ease-in-out;
    }
    .modal-overlay.show .modal-content { transform: translateY(0); }
    .modal-buttons { display: flex; justify-content: center; gap: 0.75rem; margin-top: 1.25rem; }
    .modal-button { padding: 0.6rem 1.2rem; border-radius: 9999px; font-weight: 700; cursor: pointer; transition: all 0.2s ease-in-out; }
    .modal-button.cancel { background: #e2e8f0; color: #4a5568; }
    .modal-button.cancel:hover { background: #cbd5e0; }

    .getting-started-list { list-style: none; padding-left: 0; text-align: left; counter-reset: step-counter; }
    .getting-started-list li { margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative; }
    .getting-started-list li::before {
      content: counter(step-counter); counter-increment: step-counter;
      position: absolute; left: 0; top: 0;
      background-color: #9f7aea; color: white; border-radius: 50%;
      width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;
      font-size: 0.8rem; font-weight: bold;
    }

    .description-link-container {
      display: flex; justify-content: center; align-items: center;
      margin-top: 0rem;
      margin-bottom: 1rem;
      font-size: 0.95rem; color: #6b46c1; gap: 0.5rem;
    }
    .description-link {
      display: inline-flex; align-items: center; color: #6b46c1; font-weight: 500; text-decoration: none;
      background: none; border: none; cursor: pointer; padding: 0;
    }
    .description-link:hover { color: #805ad5; text-decoration: underline; }
    .description-link i { margin-right: 0.35rem; }

    .header-separator {
      border-top: 1px solid #e5e7eb;
      margin: 0.5rem 0 1rem 0;
    }

    .bottom-tip {
      display: flex; align-items: center; justify-content: center; gap: 0.5rem;
      color: #4b5563; background: #f3f4f6; border: 1px dashed #d1d5db;
      border-radius: 9999px; padding: 0.5rem 0.875rem; font-size: 0.9rem; margin-top: 0.75rem; user-select: none;
    }
    .bottom-tip i { color: #f59e0b; }

    .nowrap { white-space: nowrap; }
    .wrap-anywhere { overflow-wrap: anywhere; }

    .modal-subheading {
      font-size: 1.125rem;
      font-weight: 600;
      color: #4a5568;
      margin-top: 1rem;
      margin-bottom: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 0.5rem;
    }

    /* Optional: secondary non-sticky actions row styles */
    .utility-row {
      margin-top: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
    }

    /* START: Modal option button styles aligned with Code B */
    #search-google-choice-btn,
    #search-bing-choice-btn,
    #search-duckduckgo-choice-btn,
    #search-brave-choice-btn,
    #translate-google-choice-btn,
    #translate-bing-choice-btn,
    #copy-question-btn {
      color: white;
      font-weight: bold;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border-radius: 9999px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.5rem;
    }
    #search-google-choice-btn { background-color: #4285F4; }
    #search-google-choice-btn:hover { background-color: #357ae8; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #search-google-choice-btn i { margin-right: 0.5rem; }

    #search-bing-choice-btn { background-color: #008AD6; }
    #search-bing-choice-btn:hover { background-color: #006FB7; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #search-bing-choice-btn i { margin-right: 0.5rem; }

    #search-duckduckgo-choice-btn { background-color: #e3722a; }
    #search-duckduckgo-choice-btn:hover { background-color: #c96024; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #search-duckduckgo-choice-btn i { margin-right: 0.5rem; }

    #search-brave-choice-btn { background-color: #FB542B; }
    #search-brave-choice-btn:hover { background-color: #d14424; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #search-brave-choice-btn i { margin-right: 0.5rem; }

    #translate-google-choice-btn { background-color: #60a5fa; }
    #translate-google-choice-btn:hover { background-color: #3b82f6; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #translate-google-choice-btn i { margin-right: 0.5rem; }

    #translate-bing-choice-btn { background-color: #008AD6; }
    #translate-bing-choice-btn:hover { background-color: #006FB7; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #translate-bing-choice-btn i { margin-right: 0.5rem; }

    #copy-question-btn { background-color: #48bb78; }
    #copy-question-btn:hover { background-color: #38a169; box-shadow: 0 6px 8px rgba(0,0,0,0.15); }
    #copy-question-btn i { margin-right: 0.5rem; }
    /* END: Modal option button styles */

    /* QR modal/link styles (from Code B, adapted) */
    .qr-code-link {
      font-size: 0.875rem;
      color: #6b46c1;
      text-decoration: none;
      transition: color 0.2s ease-in-out, text-decoration 0.2s ease-in-out;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      margin-top: 0.5rem;
      justify-content: center;
    }
    .qr-code-link:hover {
      color: #805ad5;
      text-decoration: underline;
    }
    #qr-modal-content {
      max-width: 350px;
      padding: 1.5rem;
      position: relative;
    }
    #qr-modal-content img {
      width: 100%;
      height: auto;
      max-width: 250px;
      margin: 0 auto 1rem auto;
      display: block;
      border-radius: 0.5rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .qr-modal-close-button {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #4a5568;
      line-height: 1;
      padding: 0.25rem;
      border-radius: 50%;
      transition: background-color 0.2s, color 0.2s;
    }
    .qr-modal-close-button:hover {
      background-color: #e2e8f0;
      color: #2d3748;
    }
    .qr-actions-row button,
    .qr-actions-row a {
      color: #2563eb;
      font-size: 0.875rem;
    }
    .qr-actions-sep {
      color: #9ca3af;
      font-size: 0.875rem;
      user-select: none;
    }

    /* Floating Back button */
    .floating-back-btn {
      position: fixed; left: 1rem; bottom: 1rem; z-index: 3000;
      background-color: #43c6a6; color: white; border: none; padding: .65rem .9rem; border-radius: 9999px;
      box-shadow: 0 8px 16px rgba(0,0,0,.15); display: inline-flex; align-items: center; gap: .5rem; font-weight: 600;
      transition: transform .15s ease, box-shadow .2s ease, background-color .2s ease, opacity .2s ease; opacity: .95;
      --pulse-from: #43c6a6;
      --pulse-to: #6b7280;
      --glow-color: rgba(99,102,241,0.55);
    }
    .floating-back-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 22px rgba(0,0,0,.20); background-color: #374151; opacity: 1; }
    .floating-back-btn:active { transform: translateY(0); box-shadow: 0 6px 12px rgba(0,0,0,.15); }
    @keyframes backBtnPulse {
      0%   { transform: translateY(0) scale(1);   background-color: var(--pulse-from); box-shadow: 0 0 0 rgba(0,0,0,0), 0 8px 16px rgba(0,0,0,.15); }
      50%  { transform: translateY(-1px) scale(1.06); background-color: var(--pulse-to);   box-shadow: 0 0 18px var(--glow-color), 0 12px 22px rgba(0,0,0,.20); }
      100% { transform: translateY(0) scale(1);   background-color: var(--pulse-from); box-shadow: 0 0 0 rgba(0,0,0,0), 0 8px 16px rgba(0,0,0,.15); }
    }
    .floating-back-btn.attention {
      animation: backBtnPulse 900ms ease-in-out 0s 3;
    }
    @media (prefers-reduced-motion: reduce) {
      .floating-back-btn.attention {
        animation: none;
        outline: 2px solid #a855f7;
        outline-offset: 2px;
      }
    }
  </style>
</head>
<body class="bg-gray-100 flex justify-center items-start min-h-screen p-4">
  <!-- Floating back button -->
  <button id="floating-back-button" class="floating-back-btn" aria-label="Go back">
    <i class="fas fa-arrow-left"></i>
    Back
  </button>

  <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md transition-transform">
    <div class="flex justify-center mb-6">
      <a href="../index.html" aria-label="Back to Home">
        <img src="../images/csc_logo.jpg" alt="Curious Souls Cafe Logo" class="w-24 h-24 rounded-full border-2 border-purple-500">
      </a>
    </div>

    <h1 class="text-2xl font-semibold text-purple-600 text-center mb-3">Curious Souls Caf√©</h1>
    <hr class="border-purple-300 mb-5 w-1/2 mx-auto">

    <h2 class="text-xl font-semibold text-purple-600 text-center mb-3">Saved Items</h2>
    <p class="text-center subtle mb-3">Manage items saved across all topics.</p>

    <div class="description-link-container">
      <button id="getting-started-link" class="description-link">
        <i class="fas fa-info-circle"></i> Get started
      </button>
    </div>

    <div class="header-separator"></div>

    <!-- Sticky toolbar: only Search, Expand All, Collapse All -->
    <div class="toolbar -mx-8 px-8 py-4 flex flex-col gap-3">
      <div class="flex gap-2">
        <input id="search-input" type="text" class="search-input" placeholder="Search across saved items...">
      </div>
      <div class="flex flex-wrap gap-2 justify-center">
        <button id="expand-all-btn" class="pill muted"><i class="fa-solid fa-angles-down mr-1"></i>Expand All</button>
        <button id="collapse-all-btn" class="pill muted"><i class="fa-solid fa-angles-up mr-1"></i>Collapse All</button>
      </div>
    </div>

    <!-- Optional non-sticky utility row -->
    <div class="utility-row">
      <button id="clear-all-btn" class="pill danger"><i class="fa-solid fa-trash-can mr-1"></i>Clear All Saved</button>
      <button id="export-all-btn" class="pill primary"><i class="fa-solid fa-file-arrow-down mr-1"></i>Export All</button>
    </div>

    <div id="summary" class="mt-5 mb-3 text-sm subtle"></div>

    <div id="results" class="space-y-5 mt-2"></div>

    <div id="actions-mount"></div>

    <div id="empty-state" class="empty-state mt-8 hidden">
      <p class="mb-2">No saved items found.</p>
      <p class="text-sm">Open any topic to save items, or select actions on the Action Prompts page, then check back here.</p>
    </div>

    <!-- <div class="bottom-tip mt-8" aria-live="polite">
      <i class="fa-solid fa-lightbulb"></i>
      <span>Tap the top logo for home</span>
    </div> -->

    <!-- Share page/QR code link -->
    <br>
    <a href="#" id="show-qr-code-link" class="qr-code-link">
      <i class="fas fa-qrcode"></i> Share page/QR code
    </a>
  </div>

  <!-- Floating buttons -->
  <a id="floating-dice" href="dice.html" aria-label="Open Dice Roller" title="Open Dice Roller">
    <i class="fas fa-dice"></i>
  </a>
  <button id="floating-lookup" title="Look Up Online / Translate" aria-label="Look Up Online / Translate">
    <i class="fas fa-search"></i>
  </button>
  <button id="floating-share" title="Share selected text" aria-label="Share selected text">
    <i class="fas fa-share-nodes"></i>
  </button>
  <button id="back-to-top" title="Back to Top">&#9650; Top</button>

  <!-- Search/Translate Choice Modal -->
  <div id="search-engine-modal" class="modal-overlay">
    <div class="modal-content">
      <p class="text-lg font-semibold text-gray-800 mb-4">Look It Up Online:</p>

      <h4 class="modal-subheading">Web Search</h4>
      <div class="flex flex-col items-center">
        <button id="search-google-choice-btn" type="button"><i class="fab fa-google"></i> Search Google</button>
        <button id="search-bing-choice-btn" type="button"><i class="fab fa-microsoft"></i> Search Bing</button>
        <button id="search-duckduckgo-choice-btn" type="button"><i class="fas fa-search"></i> Search DuckDuckGo</button>
        <button id="search-brave-choice-btn" type="button"><i class="fas fa-magnifying-glass"></i> Search Brave</button>
      </div>

      <h4 class="modal-subheading">Translation Services</h4>
      <div class="flex flex-col items-center">
        <button id="translate-google-choice-btn" type="button"><i class="fas fa-language"></i> Translate with Google</button>
        <button id="translate-bing-choice-btn" type="button"><i class="fas fa-language"></i> Translate with Bing</button>
      </div>

      <h4 class="modal-subheading">Other Actions</h4>
      <div class="flex flex-col items-center">
        <button id="copy-question-btn" type="button"><i class="fas fa-copy"></i> Copy Text</button>
      </div>

      <button id="close-search-engine-modal" class="modal-button cancel mt-4" type="button">Cancel</button>
    </div>
  </div>

  <!-- Getting Started Modal -->
  <div id="getting-started-modal" class="modal-overlay">
    <div class="modal-content max-w-sm">
      <h3 class="text-xl font-semibold text-gray-800 mb-3">üöÄ Meaningful Talk</h3>
      <ol class="getting-started-list">
        <li><b>Invite Others:</b> Ask folks to scan the QR code on the bottom of the main page. <a class="text-blue-600 hover:underline" href="../index.html">Open main page</a></li>
        <li><b>Pick Questions:</b> On any topic page, tap questions to save them. They‚Äôll appear here as ‚ÄúSaved Items‚Äù.</li>
        <li><b>Discuss:</b> Pick a saved question, then everyone answers it in turn. Repeat with the next person‚Äôs question.</li>
      </ol>
      <p><b>Tip:</b> Regularly tap "Export All" to back up saved items to a permanent location to avoid loss of data.</p>
      <div class="modal-buttons mt-4">
        <button id="close-getting-started-modal" class="modal-button cancel" type="button">Got it!</button>
      </div>
    </div>
  </div>

  <!-- QR Code Modal (from Code B, adapted) -->
  <div id="qr-code-modal" class="modal-overlay">
    <div id="qr-modal-content" class="modal-content">
      <button class="qr-modal-close-button" id="qr-modal-close-button" aria-label="Close QR modal">&times;</button>
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Share This Page</h3>
      <p class="text-gray-600 text-sm mb-4">Scan the QR code below to quickly share or access this page:</p>
      <img id="qr-modal-image" alt="QR Code for this page"
           src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==" />

      <p class="text-sm text-gray-700 mt-2 break-all">
        <i class="fa-solid fa-link mr-1"></i>
        <a id="qr-page-url" href="#" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all"></a>
        <br>
        <span class="qr-actions-row inline-flex items-center gap-2 mt-3">
          <button id="copy-link-text-link" class="hover:underline" type="button">
            <i class="fas fa-copy"></i> Copy page link
          </button>
          <span class="qr-actions-sep">|</span>
          <button id="share-link-button" class="hover:underline" type="button">
            <i class="fas fa-share-from-square"></i> Share...
          </button>
        </span>
      </p>
      <p class="text-gray-500 text-sm mt-4">Invite fellow curious souls to open this page and join the conversation! üòä</p>
    </div>
  </div>

  <script>
    // Random highlight color
    const highlightColors = ["#57FCFF", "#FFFFAD", "#FFC6C6"];
    const randomHighlightColor = highlightColors[Math.floor(Math.random() * highlightColors.length)];
    document.documentElement.style.setProperty('--highlight-color', randomHighlightColor);

    // Keys
    const SAVED_PREFIX = 'csc_saved_questions_';
    const ACTIONS_KEY = 'csc_saved_actions_action_prompts';

    const searchInput = document.getElementById('search-input');
    const resultsEl = document.getElementById('results');
    const emptyStateEl = document.getElementById('empty-state');
    const summaryEl = document.getElementById('summary');
    const clearAllBtn = document.getElementById('clear-all-btn');
    const exportAllBtn = document.getElementById('export-all-btn');
    const expandAllBtn = document.getElementById('expand-all-btn');
    const collapseAllBtn = document.getElementById('collapse-all-btn');
    const actionsMount = document.getElementById('actions-mount');

    // Floating + modals
    const backToTopButton = document.getElementById('back-to-top');
    const floatingLookupBtn = document.getElementById('floating-lookup');
    const floatingShareBtn = document.getElementById('floating-share');

    const searchEngineModal = document.getElementById('search-engine-modal');
    const closeSearchEngineModalBtn = document.getElementById('close-search-engine-modal');
    const searchGoogleChoiceBtn = document.getElementById('search-google-choice-btn');
    const searchBingChoiceBtn = document.getElementById('search-bing-choice-btn');
    const searchDuckDuckGoChoiceBtn = document.getElementById('search-duckduckgo-choice-btn');
    const searchBraveChoiceBtn = document.getElementById('search-brave-choice-btn');
    const translateGoogleChoiceBtn = document.getElementById('translate-google-choice-btn');
    const translateBingChoiceBtn = document.getElementById('translate-bing-choice-btn');
    const copyQuestionBtn = document.getElementById('copy-question-btn');

    // Getting started
    const gettingStartedLink = document.getElementById('getting-started-link');
    const gettingStartedModal = document.getElementById('getting-started-modal');
    const closeGettingStartedModalBtn = document.getElementById('close-getting-started-modal');

    // QR elements
    const showQrCodeLink = document.getElementById('show-qr-code-link');
    const qrCodeModal = document.getElementById('qr-code-modal');
    const qrModalImage = document.getElementById('qr-modal-image');
    const qrModalCloseButton = document.getElementById('qr-modal-close-button');
    const qrPageUrlAnchor = document.getElementById('qr-page-url');
    const copyLinkTextLink = document.getElementById('copy-link-text-link');
    const shareLinkButton = document.getElementById('share-link-button');

    // Floating Back button (from Code B)
    const floatingBackButton = document.getElementById('floating-back-button');

    // Selection state
    let selectedText = null;
    let selectedType = null; // 'topic' | 'action'
    let selectedTopicId = null; // kebab-case topic id when type === 'topic'

    // Data loaders
    function readAllSavedQuestions() {
      const topics = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (!key) continue;
        if (key.startsWith(SAVED_PREFIX)) {
          try {
            const raw = localStorage.getItem(key);
            const list = raw ? JSON.parse(raw) : [];
            const topicId = key.substring(SAVED_PREFIX.length);
            const topicName = topicId.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
            topics.push({ key, topicId, topicName, questions: Array.isArray(list) ? list : [] });
          } catch {}
        }
      }
      topics.sort((a,b) => a.topicName.localeCompare(b.topicName));
      const idx = topics.findIndex(t => t.topicName.trim().toLowerCase() === 'all in one' && t.questions.length > 0);
      if (idx > 0) {
        const [aio] = topics.splice(idx, 1);
        topics.unshift(aio);
      }
      return topics;
    }

    function readSavedActions() {
      try {
        const raw = localStorage.getItem(ACTIONS_KEY);
        const list = raw ? JSON.parse(raw) : [];
        return Array.isArray(list) ? list : [];
      } catch {
        return [];
      }
    }

    // Helpers
    function stripPrefix(text) {
      try { return text.replace(/^[\p{Emoji_Presentation}\p{Emoji}\p{S}\p{P}\s_]+/u, '').trim(); }
      catch { return text.replace(/^[^A-Za-z0-9]+/, '').trim(); }
    }

    function copyToClipboard(text) {
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert('Copied to clipboard');
    }

    function saveTopicList(key, list) {
      localStorage.setItem(key, JSON.stringify(list));
    }

    function clearAllSelected() {
      document.querySelectorAll('.selected-chip').forEach(el => el.classList.remove('selected-chip'));
      selectedText = null;
      selectedType = null;
      selectedTopicId = null;
      refreshFloatingVisibility();
    }

    function toggleChipSelection(chipEl, payload) {
      const willSelect = !chipEl.classList.contains('selected-chip');
      clearAllSelected();
      if (willSelect) {
        chipEl.classList.add('selected-chip');
        selectedText = payload.text;
        selectedType = payload.type; // 'topic' or 'action'
        selectedTopicId = payload.topicId || null;
      }
      refreshFloatingVisibility();
    }

    function refreshFloatingVisibility() {
      const shouldShow = !!selectedText;
      const displayStyle = shouldShow ? 'flex' : 'none';
      floatingLookupBtn.style.display = displayStyle;
      floatingShareBtn.style.display = displayStyle;
    }

    function kebabizeTopicId(topicId) {
      return String(topicId).replace(/_/g, '-');
    }

    function render() {
      const query = searchInput.value.trim().toLowerCase();

      const topics = readAllSavedQuestions();
      const totalTopicsWithSaved = topics.filter(t => t.questions.length > 0).length;
      const totalQuestions = topics.reduce((sum, t) => sum + t.questions.length, 0);

      const allActions = readSavedActions();
      const totalActions = allActions.length;
      const filteredActions = query
        ? allActions.filter(a => stripPrefix(a).toLowerCase().includes(query))
        : allActions.slice();

      summaryEl.textContent = `Topics with saved questions: ${totalTopicsWithSaved} ‚Ä¢ Total saved questions: ${totalQuestions} ‚Ä¢ Saved actions: ${totalActions}`;

      resultsEl.innerHTML = '';
      let anyQuestionShown = false;

      topics.forEach(topic => {
        if (topic.questions.length === 0) return;
        const filtered = query
          ? topic.questions.filter(q => stripPrefix(q).toLowerCase().includes(query))
          : topic.questions.slice();
        if (filtered.length === 0) return;

        anyQuestionShown = true;

        const card = document.createElement('div');
        card.className = 'topic-card';

        const header = document.createElement('div');
        header.className = 'flex items-center justify-between flex-wrap gap-2 mb-3';

        const left = document.createElement('div');
        left.className = 'flex items-center gap-2';
        const title = document.createElement('h3');
        title.className = 'text-lg font-semibold section-title';
        title.textContent = topic.topicName;

        const count = document.createElement('span');
        count.className = 'badge';
        count.textContent = `${filtered.length} / ${topic.questions.length}`;

        left.appendChild(title);
        left.appendChild(count);

        const actions = document.createElement('div');
        actions.className = 'flex items-center gap-2';

        const openTopicBtn = document.createElement('a');
        openTopicBtn.className = 'pill';
        openTopicBtn.innerHTML = '<i class="fa-solid fa-up-right-from-square mr-1"></i>Open';
        const kebab = kebabizeTopicId(topic.topicId);
        openTopicBtn.href = `./${kebab}.html`;
        // openTopicBtn.target = '_blank';
        openTopicBtn.rel = 'noopener noreferrer';
        openTopicBtn.title = 'Open topic page';

        const clearTopicBtn = document.createElement('button');
        clearTopicBtn.className = 'pill danger';
        clearTopicBtn.innerHTML = '<i class="fa-solid fa-trash-can mr-1"></i>Clear';
        clearTopicBtn.addEventListener('click', () => {
          if (!confirm(`Clear all saved questions for ‚Äú${topic.topicName}‚Äù?`)) return;
          saveTopicList(topic.key, []);
          render();
        });

        const collapseBtn = document.createElement('button');
        collapseBtn.className = 'pill muted';
        collapseBtn.innerHTML = '<i class="fa-solid fa-angle-up mr-1"></i>Collapse';
        const expandBtn = document.createElement('button');
        expandBtn.className = 'pill muted hidden';
        expandBtn.innerHTML = '<i class="fa-solid fa-angle-down mr-1"></i>Expand';

        actions.appendChild(openTopicBtn);
        actions.appendChild(clearTopicBtn);
        actions.appendChild(collapseBtn);
        actions.appendChild(expandBtn);

        header.appendChild(left);
        header.appendChild(actions);

        const list = document.createElement('div');
        list.className = 'space-y-2';

        filtered.forEach(q => {
          const chip = document.createElement('div');
          chip.className = 'question-chip';

          const txt = document.createElement('div');
          txt.className = 'question-text wrap-anywhere';
          txt.textContent = q;

          const qa = document.createElement('div');
          qa.className = 'question-actions flex items-center gap-2 shrink-0';

          const removeBtn = document.createElement('button');
          removeBtn.className = 'pill danger';
          removeBtn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
          removeBtn.title = 'Remove from saved';
          removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const current = readAllSavedQuestions().find(t => t.key === topic.key);
            if (!current) return;
            const idx = current.questions.indexOf(q);
            if (idx >= 0) {
              current.questions.splice(idx, 1);
              saveTopicList(topic.key, current.questions);
              render();
            }
          });

          qa.appendChild(removeBtn);

          chip.appendChild(txt);
          chip.appendChild(qa);

          chip.addEventListener('click', () => toggleChipSelection(chip, {
            type: 'topic',
            text: q,
            topicId: kebabizeTopicId(topic.topicId)
          }));

          list.appendChild(chip);
        });

        collapseBtn.addEventListener('click', () => {
          list.classList.add('hidden');
          collapseBtn.classList.add('hidden');
          expandBtn.classList.remove('hidden');
        });
        expandBtn.addEventListener('click', () => {
          list.classList.remove('hidden');
          expandBtn.classList.add('hidden');
          collapseBtn.classList.remove('hidden');
        });

        card.appendChild(header);
        card.appendChild(list);
        resultsEl.appendChild(card);
      });

      renderActionsSection(filteredActions, totalActions);

      const anyShown = anyQuestionShown || (totalActions > 0 && filteredActions.length > 0);
      emptyStateEl.classList.toggle('hidden', anyShown);
      if (!anyShown) clearAllSelected();
    }

    function renderActionsSection(filteredActions, totalActions) {
      actionsMount.innerHTML = '';
      if (totalActions === 0) return;

      const section = document.createElement('div');
      section.className = 'mt-5';

      const card = document.createElement('div');
      card.className = 'topic-card';

      const header = document.createElement('div');
      header.className = 'flex items-center justify-between flex-wrap gap-2 mb-3';

      const left = document.createElement('div');
      left.className = 'flex items-center gap-2';

      const title = document.createElement('h3');
      title.className = 'text-lg font-semibold section-title';
      title.textContent = 'Action Prompts';

      const count = document.createElement('span');
      count.className = 'badge';
      count.textContent = `${filteredActions.length} / ${totalActions}`;

      left.appendChild(title);
      left.appendChild(count);

      const right = document.createElement('div');
      right.className = 'flex items-center gap-2';

      const openLink = document.createElement('a');
      openLink.href = './action-prompts.html';
      // openLink.target = '_blank';
      openLink.rel = 'noopener noreferrer';
      openLink.className = 'pill';
      openLink.title = 'Open Action Prompts';
      openLink.innerHTML = '<i class="fa-solid fa-up-right-from-square mr-1"></i>Open';

      const clearBtn = document.createElement('button');
      clearBtn.className = 'pill danger';
      clearBtn.title = 'Clear all saved actions';
      clearBtn.innerHTML = '<i class="fa-solid fa-trash-can mr-1"></i>Clear';
      clearBtn.addEventListener('click', () => {
        if (!confirm('Clear all saved actions?')) return;
        localStorage.removeItem(ACTIONS_KEY);
        render();
      });

      const collapseBtn = document.createElement('button');
      collapseBtn.className = 'pill muted';
      collapseBtn.innerHTML = '<i class="fa-solid fa-angle-up mr-1"></i>Collapse';

      const expandBtn = document.createElement('button');
      expandBtn.className = 'pill muted hidden';
      expandBtn.innerHTML = '<i class="fa-solid fa-angle-down mr-1"></i>Expand';

      right.appendChild(openLink);
      right.appendChild(clearBtn);
      right.appendChild(collapseBtn);
      right.appendChild(expandBtn);

      header.appendChild(left);
      header.appendChild(right);

      const list = document.createElement('div');
      list.className = 'space-y-2';

      if (filteredActions.length === 0) {
        const msg = document.createElement('div');
        msg.className = 'subtle text-sm';
        msg.textContent = 'No actions match your search.';
        list.appendChild(msg);
      } else {
        filteredActions.forEach(actionText => {
          const chip = document.createElement('div');
          chip.className = 'action-chip';

          const txt = document.createElement('div');
          txt.className = 'action-text wrap-anywhere';
          txt.textContent = actionText;

          const aa = document.createElement('div');
          aa.className = 'action-actions flex items-center gap-2 shrink-0';

          const removeBtn = document.createElement('button');
          removeBtn.className = 'pill danger';
          removeBtn.innerHTML = '<i class="fa-solid fa-xmark"></i>';
          removeBtn.title = 'Remove action';
          removeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const all = readSavedActions();
            const idx = all.indexOf(actionText);
            if (idx >= 0) {
              all.splice(idx, 1);
              localStorage.setItem(ACTIONS_KEY, JSON.stringify(all));
              render();
            }
          });

          aa.appendChild(removeBtn);

          chip.appendChild(txt);
          chip.appendChild(aa);

          chip.addEventListener('click', () => toggleChipSelection(chip, {
            type: 'action',
            text: actionText
          }));

          list.appendChild(chip);
        });
      }

      collapseBtn.addEventListener('click', () => {
        list.classList.add('hidden');
        collapseBtn.classList.add('hidden');
        expandBtn.classList.remove('hidden');
      });
      expandBtn.addEventListener('click', () => {
        list.classList.remove('hidden');
        expandBtn.classList.add('hidden');
        collapseBtn.classList.remove('hidden');
      });

      card.appendChild(header);
      card.appendChild(list);
      section.appendChild(card);
      actionsMount.appendChild(section);
    }

    // Interactions
    searchInput.addEventListener('input', () => { render(); });

    // Clear All (non-sticky utility)
    if (clearAllBtn) {
      clearAllBtn.addEventListener('click', () => {
        if (!confirm('Clear ALL saved items? This cannot be undone.')) return;

        const keys = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith(SAVED_PREFIX)) keys.push(key);
        }
        keys.forEach(k => localStorage.removeItem(k));
        localStorage.removeItem(ACTIONS_KEY);

        render();
        clearAllSelected();
      });
    }

    // Export All (non-sticky utility)
    function escapeHTML(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function buildExportHTML() {
      const topics = readAllSavedQuestions();
      const actions = readSavedActions();

      const topicsWithSaved = topics.filter(t => t.questions.length > 0);
      const totalQuestions = topicsWithSaved.reduce((sum, t) => sum + t.questions.length, 0);
      const totalActions = actions.length;

      const now = new Date();
      const generated = escapeHTML(now.toLocaleString());

      const topicsHTML = topicsWithSaved.length === 0
        ? '<p class="muted">No saved questions.</p>'
        : topicsWithSaved.map(t => {
            const items = t.questions.map(q => `<li>${escapeHTML(q)}</li>`).join('');
            return `
              <section class="block">
                <h2>${escapeHTML(t.topicName)} <span class="count">(${t.questions.length})</span></h2>
                <ul>${items}</ul>
              </section>`;
          }).join('');

      const actionsHTML = totalActions === 0
        ? ''
        : `
          <section class="block">
            <h2>Saved Actions <span class="count">(${totalActions})</span></h2>
            <ul>
              ${actions.map(a => `<li>${escapeHTML(a)}</li>`).join('')}
            </ul>
          </section>`;

      const css = `
        :root {
          --bg: #ffffff;
          --fg: #0f172a;
          --muted: #6b7280;
          --rule: #e5e7eb;
          --accent: #6b46c1;
        }
        @media (prefers-color-scheme: dark) {
          :root {
            --bg: #0b1020;
            --fg: #e5e7eb;
            --muted: #9ca3af;
            --rule: #1f2937;
            --accent: #a78bfa;
          }
        }
        * { box-sizing: border-box; }
        html, body { margin: 0; padding: 0; }
        body {
          background: var(--bg);
          color: var(--fg);
          font: 16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, sans-serif;
          padding: 24px;
          max-width: 900px;
          margin: 0 auto;
        }
        header {
          border-bottom: 1px solid var(--rule);
          padding-bottom: 12px;
          margin-bottom: 20px;
        }
        h1 {
          font-size: 1.35rem;
          margin: 0 0 6px 0;
          color: var(--accent);
        }
        .meta {
          font-size: 0.9rem;
          color: var(--muted);
          margin: 0;
        }
        .summary {
          margin-top: 8px;
          font-size: 0.95rem;
          color: var(--muted);
        }
        section.block {
          margin: 20px 0;
          padding-top: 6px;
        }
        h2 {
          font-size: 1.05rem;
          margin: 0 0 8px 0;
          color: var(--accent);
        }
        .count {
          color: var(--muted);
          font-weight: 600;
          font-size: 0.95rem;
        }
        ul {
          padding-left: 1.1rem;
          margin: 0;
        }
        li {
          margin: 6px 0;
        }
        .muted {
          color: var(--muted);
        }
        footer {
          margin-top: 28px;
          padding-top: 12px;
          border-top: 1px solid var(--rule);
          font-size: 0.85rem;
          color: var(--muted);
        }
        a {
          color: var(--accent);
          text-decoration: none;
        }
        a:hover { text-decoration: underline; }
        @media print {
          body { padding: 0; }
          a { text-decoration: none; color: inherit; }
        }
      `;

      const summaryText = `Topics with saved questions: ${topicsWithSaved.length} ‚Ä¢ Total saved questions: ${totalQuestions} ‚Ä¢ Saved actions: ${totalActions}`;
      const summaryHTML = `<p class="summary">${escapeHTML(summaryText)}</p>`;

      const doc = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Curious Souls Caf√© -- Saved Export</title>
  <meta name="color-scheme" content="light dark">
  <style>${css}</style>
</head>
<body>
  <header>
    <h1>Curious Souls Caf√© -- Saved Items</h1>
    <p class="meta">Generated: ${generated}</p>
    ${summaryHTML}
  </header>

  ${topicsHTML}
  ${actionsHTML}

  <footer>
    Exported from Curious Souls Caf√©. Keep the conversation going!
  </footer>
</body>
</html>`;

      return doc;
    }

    function downloadHTMLFile(filename, html) {
      const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    if (exportAllBtn) {
      exportAllBtn.addEventListener('click', () => {
        const html = buildExportHTML();
        downloadHTMLFile('curious-souls-saved.html', html);
      });
    }

    // Expand/Collapse All
    expandAllBtn.addEventListener('click', () => {
      document.querySelectorAll('.topic-card .space-y-2').forEach(list => list.classList.remove('hidden'));
      document.querySelectorAll('.topic-card .pill.muted').forEach(btn => {
        const txt = btn.innerText.trim().toLowerCase();
        if (txt.startsWith('expand')) btn.classList.add('hidden');
        if (txt.startsWith('collapse')) btn.classList.remove('hidden');
      });

      const actionsList = actionsMount.querySelector('.space-y-2');
      if (actionsList) actionsList.classList.remove('hidden');
      const allMuted = actionsMount.querySelectorAll('.pill.muted');
      if (allMuted.length >= 2) {
        allMuted[0].classList.remove('hidden');
        allMuted[1].classList.add('hidden');
      }
    });

    collapseAllBtn.addEventListener('click', () => {
      document.querySelectorAll('.topic-card .space-y-2').forEach(list => list.classList.add('hidden'));
      document.querySelectorAll('.topic-card .pill.muted').forEach(btn => {
        const txt = btn.innerText.trim().toLowerCase();
        if (txt.startsWith('expand')) btn.classList.remove('hidden');
        if (txt.startsWith('collapse')) btn.classList.add('hidden');
      });

      const actionsList = actionsMount.querySelector('.space-y-2');
      if (actionsList) actionsList.classList.add('hidden');
      const allMuted = actionsMount.querySelectorAll('.pill.muted');
      if (allMuted.length >= 2) {
        allMuted[0].classList.add('hidden');
        allMuted[1].classList.remove('hidden');
      }
    });

    // Back-to-top
    window.addEventListener('scroll', () => {
      backToTopButton.style.display = window.scrollY > 1 ? 'block' : 'none';
    });
    backToTopButton.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Lookup modal
    function removeEmojiPrefix(text) {
      try { return text.replace(/^[\p{Emoji_Presentation}\p{Emoji}\p{S}\p{P}\s_]+/u, '').trim(); }
      catch { return text.replace(/^[^A-Za-z0-9]+/, '').trim(); }
    }
    function openChoiceModalIfSelected() {
      if (selectedText) searchEngineModal.classList.add('show');
      else alert('Please select a saved chip first.');
    }
    function closeChoiceModal() { searchEngineModal.classList.remove('show'); }

    floatingLookupBtn.addEventListener('click', openChoiceModalIfSelected);
    closeSearchEngineModalBtn.addEventListener('click', closeChoiceModal);

    function openURL(url) { window.open(url, '_blank'); }
    function doSearch(base) {
      if (!selectedText) return;
      const q = encodeURIComponent(removeEmojiPrefix(selectedText));
      openURL(base + q);
      closeChoiceModal();
    }
    function doTranslate(base) {
      if (!selectedText) return;
      const q = encodeURIComponent(removeEmojiPrefix(selectedText));
      openURL(base + q);
      closeChoiceModal();
    }

    document.getElementById('search-google-choice-btn').addEventListener('click', () => doSearch('https://www.google.com/search?q='));
    document.getElementById('search-bing-choice-btn').addEventListener('click', () => doSearch('https://www.bing.com/search?q='));
    document.getElementById('search-duckduckgo-choice-btn').addEventListener('click', () => doSearch('https://duckduckgo.com/?q='));
    document.getElementById('search-brave-choice-btn').addEventListener('click', () => doSearch('https://search.brave.com/search?q='));
    document.getElementById('translate-google-choice-btn').addEventListener('click', () => doTranslate('https://translate.google.com/?sl=auto&tl=en&text='));
    document.getElementById('translate-bing-choice-btn').addEventListener('click', () => doTranslate('https://www.bing.com/translator/?from=auto&to=en&text='));
    document.getElementById('copy-question-btn').addEventListener('click', () => {
      if (!selectedText) return;
      const ta = document.createElement('textarea');
      ta.value = removeEmojiPrefix(selectedText);
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      alert('Text copied!');
      closeChoiceModal();
    });

    // Share selected with correct URL
    function buildShareURL() {
      if (!selectedType || !selectedText) return window.location.href;
      if (selectedType === 'topic' && selectedTopicId) {
        return `${location.origin}${location.pathname.replace(/\/[^/]*$/, '/')}${selectedTopicId}.html`;
      }
      if (selectedType === 'action') {
        return `${location.origin}${location.pathname.replace(/\/[^/]*$/, '/') }action-prompts.html`;
      }
      return window.location.href;
    }

    function buildSharePayload() {
      if (!selectedText) return null;
      return {
        title: 'Curious Souls Caf√© - Saved Items',
        text: removeEmojiPrefix(selectedText),
        url: buildShareURL()
      };
    }

    async function shareSelected() {
      const payload = buildSharePayload();
      if (!payload) { alert('Please select a saved chip first.'); return; }
      if (navigator.share) {
        try { await navigator.share(payload); } catch (e) { console.warn('Share canceled/failed:', e); }
      } else {
        // Fallback: copy to clipboard if Web Share not available
        try {
          await navigator.clipboard.writeText(`${payload.text}\n${payload.url}`);
          alert('Share link copied to clipboard.');
        } catch {
          copyToClipboard(`${payload.text}\n${payload.url}`);
        }
      }
    }
    floatingShareBtn.addEventListener('click', shareSelected);

    // Getting Started
    gettingStartedLink.addEventListener('click', () => {
      gettingStartedModal.classList.add('show');
    });
    closeGettingStartedModalBtn.addEventListener('click', () => {
      gettingStartedModal.classList.remove('show');
    });

    // QR modal logic (from Code B, adapted)
    function openShareModal() {
      const pageUrl = window.location.href;
      const qrCodeApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(pageUrl)}`;
      qrModalImage.src = qrCodeApiUrl;
      qrPageUrlAnchor.href = pageUrl;
      qrPageUrlAnchor.textContent = pageUrl;
      qrCodeModal.classList.add('show');
    }
    function closeShareModal() {
      qrCodeModal.classList.remove('show');
    }

    document.getElementById('show-qr-code-link').addEventListener('click', function (event) {
      event.preventDefault();
      openShareModal();
    });
    document.getElementById('qr-modal-close-button').addEventListener('click', function () {
      closeShareModal();
    });
    document.getElementById('qr-code-modal').addEventListener('click', function (event) {
      if (event.target === qrCodeModal) {
        closeShareModal();
      }
    });

    copyLinkTextLink.addEventListener('click', function (event) {
      event.preventDefault();
      const pageUrl = window.location.href;
      const tempInput = document.createElement('textarea');
      tempInput.value = pageUrl;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      alert('Link copied to clipboard!');
    });

    shareLinkButton.addEventListener('click', async (event) => {
      event.preventDefault();
      if (navigator.share) {
        try {
          await navigator.share({
            title: document.title,
            text: 'Join me on this Saved Items page at Curious Souls Caf√©!',
            url: window.location.href
          });
        } catch (err) {
          console.warn('Share canceled or failed:', err);
        }
      } else {
        // No fallback beyond copy; keep silent per pattern
      }
    });

    // Floating Back button behavior
    function goBackFallback() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = '../index.html';
      }
    }
    function runBackButtonAttention() {
      if (!floatingBackButton) return;
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (!prefersReduced) {
        floatingBackButton.classList.add('attention');
        setTimeout(() => floatingBackButton.classList.remove('attention'), 3000);
      } else {
        floatingBackButton.style.outline = '2px solid #a855f7';
        floatingBackButton.style.outlineOffset = '2px';
        setTimeout(() => {
          floatingBackButton.style.outline = '';
          floatingBackButton.style.outlineOffset = '';
        }, 2000);
      }
    }
    if (floatingBackButton) {
      floatingBackButton.addEventListener('click', goBackFallback);
      // Defer attention pulse to next tick to avoid layout thrash
      setTimeout(runBackButtonAttention, 0);
    }

    // Initial render
    render();
  </script>
</body>
</html>