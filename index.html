<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Curious Souls Café is an app designed to spark meaningful conversations--browse curated topics, use virtual dice roller with action prompts, and enjoy deep in-person or discussions with friends or groups.">
    <title>Curious Souls Café - Web App for Meaningful Conversations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
    <meta name="theme-color" content="#a855f7">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(
                to right,
                #f3f4f6 0%,
                #ede9fe 20%,
                #ede9fe 80%,
                #f3f4f6 100%
            );
        }
        .line-break {
            height: 1px; /* Adjust this value */
            width: 100%; /* Make it span the width */
        }
        .topic-button {
            background-color: #a855f7; /* Purple-500 */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* font-semibold */
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            width: 100%; /* Full width */
            text-align: left; /* Align text to left to make space for star */
            display: flex; /* Use flexbox for alignment of text and star */
            justify-content: space-between; /* Space out text and star */
            align-items: center; /* Vertically align items */
            position: relative; /* For absolute positioning of star */
            padding-right: 3rem; /* Add padding for the star icon */
        }
        .topic-button:hover {
            background-color: #9333ea; /* Purple-600 */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .topic-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .info-link {
            color: #6b46c1; /* Purple text color */
            font-weight: 600; /* Semi-bold font */
            text-decoration: none;
            transition: color 0.2s ease-in-out, text-decoration 0.2s ease-in-out;
            /* Remove display: block and text-align: center */
        }

        .info-link:hover {
            color: #805ad5; /* Darker purple on hover */
            text-decoration: underline;
        }
        .info-link i {
            margin-right: 0.5rem; /* Space between icon and text */
        }

        /* Styles for the Action Prompts, Roll the Dice, and Submit Questions buttons */
        .action-button { 
            background: linear-gradient(to right, #1A1A1A, #4A4A4A); /* Very Dark Grey to Medium Dark Grey gradient */
            color: white; /* White text for contrast */
            font-weight: bold;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            width: 100%;
            transition: all 0.2s ease-in-out;
            display: flex; /* Changed to flex */
            justify-content: space-between; /* Space out text and star */
            align-items: center; /* Vertically align items */
            position: relative; /* For absolute positioning of star */
            padding-right: 3rem; /* Add padding for the star icon */
        }
        .action-button:hover {
            background: linear-gradient(to right, #000000, #333333); /* Even darker gradient on hover */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .action-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Modal specific styles (duplicated for index.html) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000; /* Raised above sticky search (3200/4200) and floating UI */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 300px;
            width: 90%;
            transform: translateY(-20px);
            transition: transform 0.3s ease-in-out;
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }

        .modal-button {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Full rounded */
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .modal-button.cancel {
            background-color: #e2e8f0; /* Gray-200 */
            color: #4a5568; /* Gray-700 */
        }
        .modal-button.cancel:hover {
            background-color: #cbd5e0; /* Gray-300 */
        }

        /* Social media icons styling */
        .social-icons a {
            color: #a855f7; /* Purple-500 */
            font-size: 1.8rem; /* Larger icon size */
            transition: color 0.2s ease-in-out, transform 0.2s ease-in-out;
        }
        .social-icons a:hover {
            color: #9333ea; /* Darker purple on hover */
            transform: scale(1.1);
        }

        /* Styling for the Live Discussion button */
        .live-discussion-style {
            background: linear-gradient(to right, #EF4444, #F87171); /* Red to light red gradient */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            width: 100%;
            text-align: center;
            display: block; /* Important for visibility */
            margin-bottom: 1rem; /* Space below the button */
        }
        .live-discussion-style:hover {
            background: linear-gradient(to right, #DC2626, #EF4444); /* Darker red on hover */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .live-discussion-style:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Loading spinner styles */
        .loading-spinner {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #a855f7; /* Purple */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quote of the Day styles */
        #quote-of-the-day-section {
            background-color: #f0f4f8; /* Light blue-gray */
            border-left: 5px solid #a855f7; /* Purple border */
            padding: 1rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        #quote-display {
            font-size: 1.1rem;
            font-style: italic;
            color: #374151; /* Dark gray */
            margin-bottom: 0.5rem;
        }

        #quote-author {
            font-size: 0.9rem;
            color: #6b7280; /* Medium gray */
            font-weight: 600;
        }

        /* Star icon specific styling */
        .star-icon {
            font-size: 1.25rem; /* Slightly larger star */
            color: white; /* Default color, will be overridden for filled */
            cursor: pointer;
            transition: color 0.2s ease-in-out;
            position: absolute;
            right: 1.5rem; /* Position from the right edge of the button */
            top: 50%;
            transform: translateY(-50%);
        }

        .star-icon.fa-solid {
            color: #FFD700; /* Gold color for starred */
        }
        .star-icon:hover {
            color: #FFEA00; /* Lighter gold on hover */
        }
        
        /* AddToHomescreen Button and Modal styles */
        #add-to-homescreen-btn {
            position: fixed;
            bottom: 1.1rem; /* unchanged position relative to dice */
            right: 1.1rem;
            z-index: 3000;
            background: #fff;
            color: #9333ea;
            font-size: 1.02rem; /* tiny bit larger text */
            font-weight: 600;
            border: 2px solid #a855f7;
            border-radius: 1.6rem; /* slightly more rounded */
            padding: 0.66rem 1.08rem; /* slightly larger padding */
            box-shadow: 0 6px 24px rgba(80, 30, 120, 0.08);
            cursor: pointer;
            display: none;
            transition: background 0.2s, color 0.2s;
        }

        #add-to-homescreen-btn.show {
            display: block;
        }

        #add-to-homescreen-btn:hover {
            background: #f3e8ff;
            color: #7c3aed;
        }

        /* iOS Modal */
        #ios-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.44);
            display: none;
            z-index: 4000;
            justify-content: center;
            align-items: center;
        }
        #ios-modal-overlay.show {
            display: flex;
        }
        #ios-modal-content {
            background: white;
            border-radius: 1.2rem;
            box-shadow: 0 8px 32px rgba(50,0,80,.19);
            padding: 2rem 1.2rem 1.5rem 1.2rem;
            max-width: 350px;
            width: 90vw;
            text-align: center;
        }
        #ios-modal-content img {
            width: 38px;
            margin: 0.5rem 0 0.8rem 0;
        }
        #ios-modal-content .close-modal {
            background: #e5e7eb;
            color: #555;
            border: none;
            border-radius: 9999px;
            padding: 0.4rem 1.1rem;
            font-size: 1rem;
            margin-top: 1.2rem;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        #ios-modal-content .close-modal:hover {
            background: #c7d2fe;
        }

        /* Use media queries to shrink the 'add to homescreen button' so it covers less space on small screens. */
        @media (max-width: 600px) {
            #add-to-homescreen-btn {
                padding: 0.55rem 0.9rem; /* slightly larger than before, but still compact */
                font-size: 0.96rem; /* up from 0.9rem */
                border-radius: 1.35rem;
            }
        }

        /* Ensure injected starred action buttons have the same vertical spacing as topics and actions */
        /* space-y-4 = 1rem between items, so we give each injected button a bottom margin of 1rem */
        [data-injected-starred-action="1"] {
            margin-bottom: 1rem;
        }
        /* If multiple starred actions exist, they already get 1rem via margin-bottom above */
        /* Now ensure the block that follows injected starred actions (topics-list) has NO extra margin collapse issue */
        /* Give topics-list a top margin of 0 and rely on the injected buttons' bottom margin to create the gap */
        #topics-list {
            margin-top: 0;
        }

        /* Apply 1rem (same as space-y-4) top margin to topics when starred actions are above */
        #topics-list.has-starred-actions-above {
            margin-top: 1rem;
        }

        /* Floating Dice Button */
        #floating-dice {
            position: fixed;
            bottom: 80px; /* sits above Add to Home button */
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 9999px;
            background: linear-gradient(135deg, #10b981, #06b6d4); /* teal to cyan */
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            text-decoration: none;
            z-index: 3500; /* above install button */
            transition: transform 0.15s ease-in-out, box-shadow 0.2s ease-in-out, filter 0.2s;
        }
        #floating-dice:hover, #floating-dice:focus {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 10px 18px rgba(0, 0, 0, 0.2);
            outline: none;
            filter: brightness(1.05);
        }
        #floating-dice:active {
            transform: translateY(0) scale(0.98);
        }
        #floating-dice .fa-dice {
            font-size: 1.4rem;
        }
        @media (max-width: 480px) {
            #floating-dice {
                width: 52px;
                height: 52px;
                bottom: 76px;
                right: 16px;
            }
            #floating-dice .fa-dice {
                font-size: 1.25rem;
            }
        }
        
        /* NEW: Styles for category filter buttons */
        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 1px solid #d1d5db; /* Tailwind gray-300 */
            background-color: #ffffff;
            color: #4b5563; /* Tailwind gray-600 */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 0.9rem;
        }
        .filter-btn:hover {
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        .filter-btn.active {
            background-color: #8b5cf6; /* A purple that fits the theme */
            color: #ffffff;
            border-color: #8b5cf6;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* ADD: Getting Started modal list styles (ported from Code A) */
        .getting-started-list {
            list-style-type: none;
            padding-left: 0;
            text-align: left;
            counter-reset: step-counter;
        }
        .getting-started-list li {
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            position: relative;
        }
        .getting-started-list li::before {
            content: counter(step-counter);
            counter-increment: step-counter;
            position: absolute;
            left: 0;
            top: 0;
            background-color: #9f7aea; /* Purple for step number */
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        /* Inline share trigger button style (looks like italic text) */
        #inline-share-trigger {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            color: #0000EE;
            font-style: italic;
            cursor: pointer;
        }
        #inline-share-trigger:hover, #inline-share-trigger:focus {
            text-decoration: underline;
            color: #551A8B;
            outline: none;
        }
        /* Standard hyperlink color in modal body */
        #getting-started-modal .getting-started-list a {
            color: #0000EE !important;
            font-weight: normal !important;
            background: none !important;
            border: none !important;
            text-decoration: none !important;
            cursor: pointer;
        }
        #getting-started-modal .getting-started-list a:hover,
        #getting-started-modal .getting-started-list a:focus {
            color: #551A8B !important;
            text-decoration: underline !important;
            outline: none;
        }
        #getting-started-modal .getting-started-list a:active {
            color: #551A8B !important;
        }

        /* NEW: Sticky search bar container */
        .sticky-search-container {
            position: sticky;
            top: 0; /* stick to top of the scrolling container */
            z-index: 3200; /* higher than floating controls below it */
            background: rgba(255,255,255,0.85);
            backdrop-filter: saturate(1.1) blur(6px);
            -webkit-backdrop-filter: saturate(1.1) blur(6px);
            border-bottom: 1px solid rgba(0,0,0,0.06);
        }
        /* Spacer to avoid jump when the search becomes sticky overlap */
        .sticky-search-spacer {
            height: 0.5rem; /* small breathing room under the sticky bar */
        }
    </style>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-md transition-transform">
        <div class="flex justify-center mb-6 mt-1">
            <a href="index.html">
                <img src="images/csc_logo.jpg" alt="Curious Souls Cafe Logo" class="w-24 h-24 rounded-full border-2 border-purple-500">
            </a>
        </div>
        <h1 class="text-2xl font-semibold text-purple-600 text-center mb-2">Curious Souls Café</h1>
        <hr class="border-purple-300 mb-4 w-1/2 mx-auto">

        <!-- Quote of the Day Section -->
        <div id="quote-of-the-day-section">
            <p id="quote-display">Loading quote...</p>
            <p id="quote-author"></p>
        </div>

        <h2 class="text-xl font-semibold text-gray-700 text-center mb-2">Pick a Topic:</h2>
        <p class="text-sm text-gray-500 text-center mb-4">
            💡 First-timer? <a id="open-getting-started" role="button" class="text-blue-500 hover:underline" style="color: #6b46c1;">Get started here</a>
        </p>

        <!-- Live Discussion button container - hidden by default, shown dynamically -->
        <div id="live-discussion-button-container" class="mb-4 hidden">
            <button id="live-discussion-button" class="live-discussion-style">
                Live Discussion
            </button>
        </div>

        <div class="mb-4">
            <div id="category-filter" class="flex flex-wrap justify-center gap-2">
                <!-- <button data-filter="Chosen" class="filter-btn" title="Filter for the chosen topics">Updated for KL</button> -->
                <button data-filter="New" class="filter-btn" title="Filter for the latest topics">What's New</button>
                <!-- <button data-filter="Bonding" class="filter-btn" title="Filter for Bonding topics">Bonding</button>
                <button data-filter="Self" class="filter-btn" title="Filter for Self topics">Self</button>
                <button data-filter="Wellbeing" class="filter-btn" title="Filter for Wellbeing topics">Wellness</button>
                <button data-filter="Other" class="filter-btn" title="Filter for other topics">Other</button>
                <button data-filter="Work" class="filter-btn" title="Filter for Work topics">Work</button> -->
            </div>
        </div>

        <!-- Sticky container for the filter/search input -->
        <div class="sticky-search-container">
            <div class="mb-0">
                <input type="text" id="search-bar" placeholder="Filter topics..."
                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            </div>
        </div>
        <div class="sticky-search-spacer"></div>
        <div style="margin-top:1rem"></div>
        <div id="topics-list" class="space-y-4">
            <div class="loading-spinner"></div>
            <p class="text-gray-500 text-center">Loading topics and questions...</p>
        </div>

        <p id="error-message" class="text-red-500 text-center mt-4 hidden">Failed to load topics. Please check your GitHub repository and network connection.</p>
        
        <!-- Action Buttons Container -->
        <div id="action-buttons-container" class="space-y-4 mt-4"> 
            <!-- Buttons will be dynamically added here by JavaScript -->
        </div>

        <div class="mt-8 pt-4 border-t border-gray-300 text-center">
            <h3 class="text-xl font-semibold text-purple-600 mb-4">Share with friends:</h3>
            <img src="images/qr/qr-code.png" 
                        alt="QR Code to launch app" 
                        class="w-48 h-48 mx-auto rounded-lg shadow-md border border-gray-200 mb-4"
                        onerror="this.onerror=null;this.src='https://placehold.co/192x192/E0E0E0/6B46C1?text=QR+Code+Loading';"
            >
                        
            <p class="text-gray-500 text-sm mt-4" style="margin-top:30px;">Let's help fellow curious souls launch this page and start the conversation! 😊</p>
            
            <p class="text-sm text-gray-700 mt-2">
                <i class="text-xs fa-solid fa-link"></i> 
                <a href="https://curioussoulscafe.github.io" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all">curioussoulscafe.github.io</a>&nbsp;<span class="text-gray-400 text-xs select-none">|</span>&nbsp;<button id="copy-link-text-link" class="text-blue-600 text-xs mt-4 hover:underline"><i class="fas fa-copy"></i></button>&nbsp;<span class="text-gray-400 text-xs select-none">|</span>&nbsp;<button id="share-link-button" class="text-blue-600 text-xs mt-4 hover:underline"><i class="fas fa-share-from-square"></i></button>
            </p>

            <!-- Social Media Icons in a single row -->
            <div class="social-icons flex justify-center w-full space-x-4 mt-4 mb-4">
                <!--
                <a href="https://x.com/curioussoulcafe" target="_blank" rel="noopener noreferrer" aria-label="Follow us on X">
                    <i class="fa-brands fa-x-twitter"></i>
                </a>
                <a href="https://facebook.com/curious.souls.cafe" target="_blank" rel="noopener noreferrer" aria-label="Follow us on Facebook">
                    <i class="fa-brands fa-facebook-f"></i>
                </a>
                <a href="https://www.instagram.com/curious.souls.cafe" target="_blank" rel="noopener noreferrer" aria-label="Books on Threads">
                    <i class="fa-brands fa-threads"></i>
                </a>
                <a href="https://curioussoulscafe.substack.com" target="_blank" rel="noopener noreferrer" aria-label="Read us on Substack">
                    <i class="fa-solid fa-book-open"></i>
                </a>
                <a href="https://medium.com/@curious.souls.cafe" target="_blank" rel="noopener noreferrer" aria-label="Read us on Medium">
                    <i class="fa-brands fa-medium-m"></i>
                </a>
                <a href="https://github.com/curioussoulscafe/curious-souls-cafe" target="_blank" rel="noopener noreferrer" aria-label="Check out our GitHub">
                    <i class="fa-brands fa-github"></i>
                </a>
                <a href="https://open.spotify.com/playlist/0J2HrFNQ9sNyKpb9PPuH6G" target="_blank" rel="noopener noreferrer" aria-label="Listen on Spotify">
                    <i class="fa-brands fa-spotify"></i>
                </a>
                <a href="https://www.youtube.com/playlist?list=PL7ZT8-PyWbiArNVAThiHiGyxAj33wq6uw" target="_blank" rel="noopener noreferrer" aria-label="Watch on YouTube">
                    <i class="fa-brands fa-youtube"></i>
                </a>
                <a href="mailto:curious.souls.cafe@gmail.com" aria-label="Email us">
                    <i class="fa-solid fa-envelope"></i>
                </a>
                <a href="https://www.goodreads.com/review/list/189570926-curious-souls-cafe?shelf=curious-souls-cafe" target="_blank" rel="noopener noreferrer" aria-label="Books on Goodreads">
                    <i class="fa-solid fa-book"></i>
                </a>
                <a href="https://www.imdb.com/list/ls596985152/" target="_blank" rel="noopener noreferrer" aria-label="Media Content on IMDb">
                    <i class="fa-solid fa-film"></i>
                </a>
                <a href="mailto:curious.souls.cafe@gmail.com" aria-label="Email us">
                    <i class="fa-solid fa-envelope"></i>
                </a>
                -->
                <a href="pages/welcome.html" aria-label="Welcome Leaflet">
                    <i class="fa-solid fa-book-open"></i> </a>
            </div>

            <div class="flex justify-center items-center space-x-3 mt-4">
                <!-- <a href="readme.html" class="info-link inline-flex items-center">
                    <i class="fas fa-info-circle mr-1"></i>Guide
                </a> -->
                <button id="open-guide-modal" class="info-link inline-flex items-center" type="button" aria-haspopup="dialog" aria-controls="guide-modal-overlay">
                    <i class="fas fa-comment-dots mr-1"></i>Guide
                </button>
                <span class="text-gray-400 text-lg select-none">|</span>
                <!-- Feedback: replaced anchor link with modal trigger button (kept comment context) -->
                <button id="open-feedback-modal" class="info-link inline-flex items-center" type="button" aria-haspopup="dialog" aria-controls="feedback-modal-overlay">
                    <i class="fas fa-comment-dots mr-1"></i>Connect
                </button>
                <span class="text-gray-400 text-lg select-none">|</span>
                <!-- Blog: replaced anchor link with modal trigger button (similar to Feedback modal) -->
                <button id="open-blog-modal" class="info-link inline-flex items-center" type="button" aria-haspopup="dialog" aria-controls="blog-modal-overlay">
                    <i class="fas fa-rss mr-1"></i>Blog
                </button>
            </div>
             <div class="line-break"></div>
        </div>
    </div>

    <!-- Floating Dice Button (links to pages\dice.html) -->
    <a id="floating-dice" href="pages\dice.html" aria-label="Open Dice Roller" title="Open Dice Roller">
        <i class="fas fa-dice"></i>
    </a>

    <!-- Add to Homescreen button -->
    <button id="add-to-homescreen-btn">
        <i class="fa-solid fa-house-medical-circle-check mr-2"></i>
        Add to Home
    </button>

    <!-- iOS Instructions Modal -->
    <div id="ios-modal-overlay">
        <div id="ios-modal-content">
            <img src="images/icons/icon-48.png" alt="CSCafe Icon">
            <h3 class="text-lg font-semibold mb-2 text-purple-600">Add to Home</h3>
            <p class="text-gray-700 mb-2">
                1. Tap the <span style="font-weight:600;">Share</span> <span style="font-size:1.5em;">&#x1f5d2;&#xfe0f;</span> button in the browser.<br>
                2. Scroll and tap <span style="font-weight:600;">"Add to Home"</span>.<br>
                3. Tap <span style="font-weight:600;">Add</span> in the top right.
            </p>
            <button class="close-modal">Close</button>
        </div>
    </div>

    <!-- Feedback modal -->
    <div
        id="feedback-modal-overlay"
        class="modal-overlay"
        role="dialog"
        aria-modal="true"
        aria-labelledby="feedback-modal-title"
        aria-describedby="feedback-modal-desc"
    >
        <div class="modal-content">
            <h3
                id="feedback-modal-title"
                class="text-lg font-semibold mb-2 text-purple-600"
            >
                How would you like to connect?
            </h3>
            <p id="feedback-modal-desc" class="text-gray-700 mb-3">
                Choose an option to continue:
            </p>
            <div class="space-y-2">
                <!-- Modified: button to open events selector modal -->
                <button
                    id="open-events-selector"
                    type="button"
                    class="modal-button block w-full text-center"
                    style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: #fff;"
                    aria-haspopup="dialog"
                    aria-controls="events-selector-modal"
                >
                    <i class="fab fa-meetup mr-1"></i> Meet us at our events!
                </button>
                <a
                    class="modal-button block w-full text-center"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://curioussoulscafe.github.io/links/share-questions"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-circle-question mr-1"></i> Submit a question
                </a>
                <a
                    class="modal-button block w-full text-center"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://curioussoulscafe.github.io/links/share-feedback"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-message mr-1"></i> Give feedback
                </a>
                <a
                    class="modal-button block w-full text-center"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="mailto:curious.souls.cafe@gmail.com"
                >
                    <i class="fa-solid fa-envelope mr-1"></i> Email us
                    (curious.souls.cafe [at] gmail.com)
                </a>
                <!-- NEW: Share this app option (Web Share API same as other share button) -->
                <button
                    id="share-app-from-feedback"
                    type="button"
                    class="modal-button block w-full text-center"
                    style="background:#ecfeff; color:#0e7490; border:1px solid #a5f3fc;"
                >
                    <i class="fa-solid fa-share-from-square mr-1"></i> Share this app to connect with others
                </button>
                <button
                    type="button"
                    class="modal-button cancel block w-full text-center"
                    id="close-feedback-modal"
                >
                    <i class="fa-solid fa-xmark mr-1"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Events selector modal (opened from 'Meet us at our events!') -->
    <div
        id="events-selector-modal"
        class="modal-overlay"
        role="dialog"
        aria-modal="true"
        aria-labelledby="events-selector-title"
        aria-describedby="events-selector-desc"
    >
        <div class="modal-content" style="max-width: 380px;">
            <h3
                id="events-selector-title"
                class="text-lg font-semibold mb-2 text-purple-600"
            >
                Choose your city
            </h3>
            <p id="events-selector-desc" class="text-gray-700 mb-3">
                Find our events on Meetup:
            </p>
            <div class="space-y-2 text-left">
                <a
                    class="modal-button block w-full text-left"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://www.meetup.com/curious-souls-cafe/"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-location-dot mr-2"></i>
                    Hong Kong (and beyond)
                </a>
                <a
                    class="modal-button block w-full text-left"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://www.meetup.com/curious-souls-cafe-singapore/"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-location-dot mr-2"></i>
                    Singapore
                </a>
                <a
                    class="modal-button block w-full text-left"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://www.meetup.com/curious-souls-cafe-seoul/"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-location-dot mr-2"></i>
                    Seoul
                </a>
                <a
                    class="modal-button block w-full text-left"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://www.meetup.com/curious-souls-cafe-taipei/"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-location-dot mr-2"></i>
                    Taipei
                </a>
                <a
                    class="modal-button block w-full text-left"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://www.meetup.com/curious-souls-cafe-osaka/"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-location-dot mr-2"></i>
                    Osaka
                </a>
                <a
                    class="modal-button block w-full text-left"
                    style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;"
                    href="https://www.meetup.com/curious-souls-cafe-kuala-lumpur/"
                    target="_blank"
                    rel="noopener noreferrer"
                >
                    <i class="fa-solid fa-location-dot mr-2"></i>
                    Kuala Lumpur
                </a>
                <!-- ADDED: Global Event List link at the end -->
                <a
                    class="modal-button block w-full text-left"
                    style="background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe;"
                    href="descriptions/global-event-list.html"
                >
                    <i class="fa-solid fa-globe mr-2"></i>
                    Global Event List
                </a>
                <button
                    type="button"
                    class="modal-button cancel block w-full text-center"
                    id="close-events-selector"
                >
                    <i class="fa-solid fa-xmark mr-1"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Blog modal (options to Substack content) -->
    <div id="blog-modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="blog-modal-title">
        <div class="modal-content">
            <h3 id="blog-modal-title" class="text-lg font-semibold mb-2 text-purple-600">Explore our blog</h3>
            <!-- <p id="blog-modal-desc" class="text-gray-700 mb-3">Choose a page to visit:</p> -->
            <div class="space-y-2">
                <!-- Start here -->
                <div class="text-left">
                    <h4 class="font-semibold text-gray-800 mb-2">Start here</h4>
                </div>
                <a class="modal-button block w-full text-center" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: #fff;" href="https://curioussoulscafe.substack.com/" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-house mr-1"></i> Home
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="https://curioussoulscafe.substack.com/about" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-circle-info mr-1"></i> About
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="https://curioussoulscafe.substack.com/p/welcome" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-book-open-reader mr-1"></i> Welcome Leaflet
                </a>

                <!-- How our events work -->
                <div class="text-left mt-3">
                    <h4 class="font-semibold text-gray-800 mb-2">How our events work</h4>
                </div>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="https://curioussoulscafe.substack.com/p/event-structure" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-calendar-days mr-1"></i> Event Structure
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="https://curioussoulscafe.substack.com/p/roll-the-colored-dice" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-dice mr-1"></i> Our Colored Dice
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="https://curioussoulscafe.substack.com/p/frequently-asked-questions" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-circle-question mr-1"></i> FAQ
                </a>

                <!-- Archive -->
                <div class="text-left mt-3">
                    <h4 class="font-semibold text-gray-800 mb-2">Explore past meetups</h4>
                </div>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="https://curioussoulscafe.substack.com/archive" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-box-archive mr-1"></i> Archive
                </a>

                <button type="button" class="modal-button cancel block w-full text-center" id="close-blog-modal">
                    <i class="fa-solid fa-xmark mr-1"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Guide modal (links to Code A headers via anchors) -->
    <div id="guide-modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="guide-modal-title" aria-describedby="guide-modal-desc">
        <div class="modal-content">
            <h3 id="guide-modal-title" class="text-lg font-semibold mb-2 text-purple-600">App guide contents</h3>
            <p id="guide-modal-desc" class="text-gray-700 mb-3">Jump to a section:</p>
            <div class="space-y-2">
                <!-- For each header in readme.html (Code A), link via anchor -->
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#curious-souls-caf-">
                    <i class="fa-solid fa-house mr-1"></i> Overview
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-getting-started">
                    <i class="fa-solid fa-rocket mr-1"></i> Getting Started
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-introducing-the-question-decks">
                    <i class="fa-solid fa-book mr-1"></i> Introducing the Question Decks
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-what-you-can-do-with-the-web-app">
                    <i class="fa-solid fa-wand-magic-sparkles mr-1"></i> What You Can Do with the Web App
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-a-fun-little-secret-">
                    <i class="fa-solid fa-dice mr-1"></i> A Fun Little Secret!
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-tips-for-using-the-app">
                    <i class="fa-solid fa-lightbulb mr-1"></i> Tips for Using the App
                </a>
                <!-- Changed: Advanced -> Contribute with GitHub icon -->
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-how-files-are-organized">
                    <i class="fa-brands fa-github mr-1"></i> Contribute
                </a>
                <!-- <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-for-contributors">
                    <i class="fa-solid fa-people-group mr-1"></i> For Event Facilitators
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-how-to-add-new-question-sets">
                    <i class="fa-solid fa-square-plus mr-1"></i> How to Add New Question Sets
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#lightning-update-service-worker">
                    <i class="fa-solid fa-bolt mr-1"></i> Update Service Worker
                </a>
                <a class="modal-button block w-full text-center" style="background:#f8fafc; color:#334155; border:1px solid #e5e7eb;" href="readme.html#-managing-live-discussion-questions">
                    <i class="fa-solid fa-comments mr-1"></i> Managing Live Discussion Questions
                </a> -->
                <button type="button" class="modal-button cancel block w-full text-center" id="close-guide-modal">
                    <i class="fa-solid fa-xmark mr-1"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Getting Started Modal (ported & adapted from Code A) -->
    <div id="getting-started-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="getting-started-title">
        <div class="modal-content max-w-sm">
            <h3 id="getting-started-title" class="text-xl font-semibold text-gray-800 mb-4">🚀 Meaningful Talk</h3>
            <ol class="getting-started-list">
                <li><b>Invite others:</b> Share the <button id="inline-share-trigger" type="button"><i>QR code or link</i></button> so everyone can open this main page.</li>
                <li><b>Pick a topic:</b> Choose one together below (you can favorite topics for quick access later).</li>
                <li><b>Open the topic page:</b> Use “Next Questions!” to draw prompts, tap to save, and take turns answering together.<br><br><strong>Optional:</strong> Roll the <span style="font-style: italic"><a href="pages/dice.html">dice</a></span> to choose who starts or to add playful actions.</li>
            </ol>
            <button id="close-getting-started-modal" class="modal-button cancel mt-4">Got it!</button>
        </div>
    </div>

    <!-- NEW: QR Code Modal (adapted for main page sharing) -->
    <div id="qr-code-modal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="qr-modal-title">
        <div id="qr-modal-content" class="modal-content" style="max-width:350px; position:relative;">
            <button class="qr-modal-close-button" id="qr-modal-close-button" style="position:absolute; top:0.75rem; right:0.75rem; background:none; border:none; font-size:1.5rem; cursor:pointer; color:#4a5568; line-height:1; padding:0.25rem; border-radius:50%;">&times;</button>
            <h3 id="qr-modal-title" class="text-lg font-semibold text-gray-800 mb-2">Share This App</h3>
            <p class="text-gray-600 text-sm mb-4">Scan to open the main page:</p>
            <img id="qr-modal-image" src="images/qr/qr-code.png" alt="QR Code for this page"
                 onerror="this.onerror=null;this.src='https://placehold.co/192x192/E0E0E0/6B46C1?text=QR+Code+Loading';"
                 style="width:100%; height:auto; max-width:250px; margin:0 auto 1rem auto; display:block; border-radius:0.5rem; box-shadow:0 4px 8px rgba(0,0,0,0.1);">
            <p class="text-sm text-gray-700 mt-2">
                <i class="fa-solid fa-link mr-1"></i> 
                <a id="qr-link-anchor" href="https://curioussoulscafe.github.io" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all">https://curioussoulscafe.github.io</a>
                <br>
                <button id="copy-link-text-link-qr" class="text-blue-600 text-sm mt-4 hover:underline"><i class="fas fa-copy">&nbsp;&nbsp;</i>Copy page link</button>
                &nbsp;<span class="text-gray-400 text-sm select-none">|</span>&nbsp;&nbsp;<button id="share-link-button-qr" class="text-blue-600 text-sm mt-4 hover:underline"><i class="fas fa-share-from-square"></i> Share...</button>
            </p>
            <p class="text-gray-500 text-sm mt-4">Help fellow curious souls launch this page and start the conversation! 😊</p>
        </div>
    </div>

    <script>
        const STARRED_TOPICS_KEY = 'csc_starred_topics';
        const STARRED_ACTION_PROMPTS_KEY = 'csc_starred_action_prompts';
        const STARRED_DICE_ROLL_KEY = 'csc_starred_dice_roll';
        const STARRED_SUBMIT_QUESTIONS_KEY = 'csc_starred_submit_questions'; // New key for submit questions button

        const topicsListDiv = document.getElementById('topics-list');
        const errorMessageDiv = document.getElementById('error-message');
        const quoteDisplay = document.getElementById('quote-display');
        const quoteAuthor = document.getElementById('quote-author');
        const searchBar = document.getElementById('search-bar');
        const actionButtonsContainer = document.getElementById('action-buttons-container');

        const quotesTxtUrl = 'data/famous-quotes.txt';
        const quotesLocalStorageKey = 'csc_quotes_data'; 

        const liveDiscussionButtonContainer = document.getElementById('live-discussion-button-container');
        const liveDiscussionButton = document.getElementById('live-discussion-button');

        let allButtons = [];
        let activeCategoryFilter = null; // State for single category filter

        const TOPIC_CONFIGS = [
            {
               name: "Live Discussion",
               htmlFileName: "pages/live-discussion.html",
               txtUrl: "questions/live-discussion.txt",
               cache: false
            },
            // Self
            { name: "Authenticity", htmlFileName: "pages/authenticity.html", txtUrl: "questions/authenticity.txt", cache: true, category: ["Self"] },
            { name: "Inner Child", htmlFileName: "pages/inner-child.html", txtUrl: "questions/inner-child.txt", cache: true, category: ["Self","Wellbeing","Editor"] },
            { name: "Purpose", htmlFileName: "pages/purpose.html", txtUrl: "questions/purpose.txt", cache: true, category: ["Self", "Work", "New"] },
            { name: "Reflection", htmlFileName: "pages/reflection.html", txtUrl: "questions/reflection.txt", cache: true, category: ["Self"] },
            { name: "Reimagine", htmlFileName: "pages/reimagine.html", txtUrl: "questions/reimagine.txt", cache: true, category: ["Self"] },
            { name: "Adulthood", htmlFileName: "pages/adulthood.html", txtUrl: "questions/adulthood.txt", cache: true, category: ["Self"] },
            { name: "Transitions", htmlFileName: "pages/transitions.html", txtUrl: "questions/transitions.txt", cache: true, category: ["Self"] },
            { name: "True Wealth", htmlFileName: "pages/true-wealth.html", txtUrl: "questions/true-wealth.txt", cache: true, category: ["Self"] },
            { name: "Legacy", htmlFileName: "pages/legacy.html", txtUrl: "questions/legacy.txt", cache: true, category: ["Self", "New"] },
            
            // Wellbeing
            { name: "Happiness", htmlFileName: "pages/happiness.html", txtUrl: "questions/happiness.txt", cache: true, category: ["Wellbeing","Editor"] },
            { name: "The Mind Speaks", htmlFileName: "pages/the-mind-speaks.html", txtUrl: "questions/the-mind-speaks.txt", cache: true, category: ["Wellbeing","Editor"] },

            // Bonding
            { name: "Friendship", htmlFileName: "pages/friendship.html", txtUrl: "questions/friendship.txt", cache: true, category: ["Bonding","Editor"] },
            { name: "Icebreaker", htmlFileName: "pages/icebreaker.html", txtUrl: "questions/icebreaker.txt", cache: true, category: ["Bonding","Editor","Other"] },
            { name: "Interdependence", htmlFileName: "pages/interdependence.html", txtUrl: "questions/interdependence.txt", cache: true, category: ["Bonding"] },
            { name: "Love Relationships", htmlFileName: "pages/love-relationships.html", txtUrl: "questions/love-relationships.txt", cache: true, category: ["Bonding","Editor"] },
            { name: "Parenting", htmlFileName: "pages/parenting.html", txtUrl: "questions/parenting.txt", cache: true, category: ["Bonding"] },

            // Work
            { name: "Work that Resonates", htmlFileName: "pages/work-that-resonates.html", txtUrl: "questions/work-that-resonates.txt", cache: true, category: ["Work"] },
            { name: "Entrepreneurship", htmlFileName: "pages/entrepreneurship.html", txtUrl: "questions/entrepreneurship.txt", cache: true, category: ["Work"] },

            // Other
            { name: "All in One", htmlFileName: "pages/all-in-one.html", txtUrl: "questions/all-in-one.txt", cache: true, category: ["Other"] },
            { name: "Global Curiosities", htmlFileName: "pages/global-curiosities.html", txtUrl: "questions/global-curiosities.txt", cache: true, category: ["Other","Chosen"] }
            
            // No Category
            // { name: "Icebreaker", htmlFileName: "pages/icebreaker.html", txtUrl: "questions/icebreaker.txt", cache: true },
            // { name: "All in One", htmlFileName: "pages/all-in-one.html", txtUrl: "questions/all-in-one.txt", cache: true }
        ];


        // Added: unified starred actions storage (for Action Prompts, Roll the Dice, Import Questions)
        const STARRED_ACTIONS_KEY = 'csc_starred_actions';
        
        /************************************************************************
         * ONE-TIME CACHE CLEARING CODE - START
         * This block clears the old question and quote caches for all users once.
         * You can remove this code in a future update after it has been deployed
         * for a while. The 'cache_cleared_v2' key can be changed if you need
         * to force another refresh in the future (e.g., 'cache_cleared_v3').
         ************************************************************************/
        if (!localStorage.getItem('cache_cleared_v2')) {
            console.log("Performing one-time cache invalidation...");

            // 1. Clear all cached topic question files
            TOPIC_CONFIGS.forEach(topicConfig => {
                if (topicConfig.cache) { // Only attempt to clear items that were cached
                    const oldKey = `csc_topic_${topicConfig.name.replace(/ /g, '_').toLowerCase()}`;
                    localStorage.removeItem(oldKey);
                    console.log(`Removed old cache key: ${oldKey}`);
                }
            });

            // 2. Clear the cached quotes file
            const quotesLocalStorageKey = 'csc_quotes_data';
            localStorage.removeItem(quotesLocalStorageKey);
            console.log(`Removed old cache key: ${quotesLocalStorageKey}`);

            // 3. Set a flag so this script doesn't run again for this user
            localStorage.setItem('cache_cleared_v2', 'true');
            console.log("One-time cache invalidation complete.");
        }
        /************************************************************************
         * ONE-TIME CACHE CLEARING CODE - END
         ************************************************************************/

        function getStarredTopics() {
            const starredTopicsJson = localStorage.getItem(STARRED_TOPICS_KEY);
            return starredTopicsJson ? JSON.parse(starredTopicsJson) : [];
        }

        function setStarredTopics(topics) {
            localStorage.setItem(STARRED_TOPICS_KEY, JSON.stringify(topics));
        }

        function getStarredButtonState(key) {
            const state = localStorage.getItem(key);
            return state === 'true'; // Returns true if 'true', false otherwise (including null)
        }

        function setStarredButtonState(key, isStarred) {
            localStorage.setItem(key, isStarred ? 'true' : 'false');
        }

        // Helpers for action starring
        function getStarredActions() {
            const json = localStorage.getItem(STARRED_ACTIONS_KEY);
            return json ? JSON.parse(json) : []; // array of action names
        }
        function setStarredActions(list) {
            localStorage.setItem(STARRED_ACTIONS_KEY, JSON.stringify(list));
        }
        function toggleActionStar(name) {
            const current = getStarredActions();
            const idx = current.indexOf(name);
            if (idx >= 0) current.splice(idx, 1);
            else current.push(name);
            setStarredActions(current);
        }
        function isActionStarred(name) {
            return getStarredActions().includes(name);
        }

        /**
         * Updates the star icon's visual state.
         * @param {HTMLElement} starElement The <i> element for the star.
         * @param {boolean} isStarred Whether the item is starred.
         */
        function updateStarIcon(starElement, isStarred) {
            if (starElement) {
                if (isStarred) {
                    starElement.classList.remove('fa-regular');
                    starElement.classList.add('fa-solid');
                } else {
                    starElement.classList.remove('fa-solid');
                    starElement.classList.add('fa-regular');
                }
            }
        }

        /**
         * Filters displayed buttons based on the active category and search input.
         * - Topic buttons respect category + search.
         * - Non-topic buttons are hidden when a category filter is active.
         */
        function filterButtons() {
            const searchTerm = searchBar.value.toLowerCase();

            allButtons.forEach(button => {
                const isTopic = button.classList.contains('topic-button');
                const isLiveDiscussion = button.classList.contains('live-discussion-style');

                // Category match
                let categoryMatch = false;
                if (isTopic) {
                    if (!activeCategoryFilter) {
                        categoryMatch = true;
                    } else {
                        const buttonCategories = button.dataset.category ? button.dataset.category.split(',') : [];
                        categoryMatch = buttonCategories.includes(activeCategoryFilter);
                    }
                } else {
                    // Non-topic buttons should NOT show when a category filter is active
                    categoryMatch = !activeCategoryFilter;
                }

                // Search match
                let searchTermMatch = false;
                const buttonTextSpan = button.querySelector('span');
                if (buttonTextSpan) {
                    searchTermMatch = buttonTextSpan.textContent.toLowerCase().includes(searchTerm);
                } else if (isLiveDiscussion) {
                    searchTermMatch = button.textContent.toLowerCase().includes(searchTerm);
                } else {
                    // Fallback for any other button without a span
                    searchTermMatch = button.textContent.toLowerCase().includes(searchTerm);
                }

                const isVisible = categoryMatch && searchTermMatch;

                if (isVisible) {
                    button.style.display = isLiveDiscussion ? 'block' : 'flex';
                } else {
                    button.style.display = 'none';
                }
            });
        }


        /**
         * Order topics so that:
         * - If "All in One" is starred, it is first.
         * - Else, starred topics (except "All in One") first (alphabetical),
         * then "All in One",
         * then other unstarred topics (alphabetical).
         */
        function orderTopicsWithAllQuestionsPriority(successfulTopics, starredTopics) {
            const ALL = "All in One";

            // Split topics
            const isStarred = t => starredTopics.includes(t.name);
            const isAll = t => t.name === ALL;

            const allTopic = successfulTopics.find(isAll);
            const others = successfulTopics.filter(t => !isAll(t));

            const starredOthers = others.filter(isStarred).sort((a, b) => a.name.localeCompare(b.name));
            const unstarredOthers = others.filter(t => !isStarred(t)).sort((a, b) => a.name.localeCompare(b.name));

            const allIsStarred = allTopic ? starredTopics.includes(ALL) : false;

            if (!allTopic) {
                // Fallback: no "All in One" present; starred first (alpha), then unstarred (alpha)
                const starred = others.filter(isStarred).sort((a, b) => a.name.localeCompare(b.name));
                const unstarred = others.filter(t => !isStarred(t)).sort((a, b) => a.name.localeCompare(b.name));
                return [...starred, ...unstarred];
            }

            if (allIsStarred) {
                // "All in One" on top regardless of others
                return [allTopic, ...starredOthers, ...unstarredOthers];
            } else {
                // Starred others first, then "All in One", then unstarred others
                return [...starredOthers, allTopic, ...unstarredOthers];
            }
        }

        /**
         * Fetches topic content based on TOPIC_CONFIGS and stores in localStorage (selectively).
         * Creates buttons for each topic.
         */
        async function fetchAndCacheTopics() {
            topicsListDiv.innerHTML = '<div class="loading-spinner"></div><p class="text-gray-500 text-center">Loading topics and questions...</p>';
            errorMessageDiv.classList.add('hidden');
            
            let successfulTopics = [];
            let liveDiscussionFound = false;

            // Check for Live Discussion file existence first
            try {
                const liveDiscussionCheckResponse = await fetch('questions/live-discussion.txt', { method: 'HEAD' });
                if (liveDiscussionCheckResponse.ok) {
                    liveDiscussionFound = true;
                    console.log('live-discussion.txt found. Live Discussion button will be shown.');
                }
            } catch (error) {
                console.warn('Could not check for live-discussion.txt:', error);
            }

            for (const topicConfig of TOPIC_CONFIGS) {
                try {
                    const localStorageKey = `csc_topic_${topicConfig.name.replace(/ /g, '_').toLowerCase()}`; 
                    let content = null;

                    if (topicConfig.cache) {
                        content = localStorage.getItem(localStorageKey);
                    }

                    if (!content) {
                        const response = await fetch(topicConfig.txtUrl); 
                        if (!response.ok) {
                            console.warn(`Could not fetch content for ${topicConfig.name} from ${topicConfig.txtUrl}: ${response.statusText}`);
                            continue; 
                        }
                        content = await response.text();
                        if (topicConfig.cache) { 
                            localStorage.setItem(localStorageKey, content);
                            console.log(`Cached content for '${topicConfig.name}'.`);
                        } else {
                            console.log(`Fetched content for '${topicConfig.name}' (not cached).`);
                        }
                    } else {
                        console.log(`Loaded content for '${topicConfig.name}' from localStorage.`);
                    }
                    successfulTopics.push(topicConfig); 
                } catch (error) {
                    console.error(`Error processing topic '${topicConfig.name}':`, error);
                }
            }

            topicsListDiv.innerHTML = ''; 

            // Display Live Discussion button if configured
            if (liveDiscussionFound) {
                liveDiscussionButtonContainer.classList.remove('hidden');
                liveDiscussionButton.addEventListener('click', () => {
                    window.location.href = 'pages/live-discussion.html'; 
                });
            } else {
                liveDiscussionButtonContainer.classList.add('hidden'); 
            }

            if (successfulTopics.length === 0 && !liveDiscussionFound) {
                topicsListDiv.innerHTML = '<p class="text-gray-500 text-center">No topics could be loaded. Please check the topic configurations and file paths.</p>';
                errorMessageDiv.classList.remove('hidden');
            } else {
                const starredTopics = getStarredTopics();

                // Apply custom ordering with "All in One" rules
                const sortedTopics = orderTopicsWithAllQuestionsPriority(successfulTopics, starredTopics);

                sortedTopics.forEach(topic => {
                    // Skip the Live Discussion topic here as its button is handled separately
                    if (topic.name === "Live Discussion") return;

                    const button = document.createElement('button');
                    button.classList.add('topic-button');
                    // Add data-category attribute if it exists, joining the array
                    if (topic.category && topic.category.length > 0) {
                        button.dataset.category = topic.category.join(',');
                    }
                    
                    const topicNameSpan = document.createElement('span');
                    topicNameSpan.textContent = topic.name;
                    topicNameSpan.style.pointerEvents = 'none'; // Ensure clicks on text pass through to button

                    const starIcon = document.createElement('i');
                    starIcon.classList.add('star-icon', 'fa-star'); // Base classes
                    
                    const isStarred = starredTopics.includes(topic.name);
                    updateStarIcon(starIcon, isStarred); // Set initial star icon state

                    // Event listener for the star icon
                    starIcon.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent the button's click event from firing
                        const currentStarred = getStarredTopics();
                        const index = currentStarred.indexOf(topic.name);

                        if (index > -1) {
                            // Topic is already starred, unstar it
                            currentStarred.splice(index, 1);
                        } else {
                            // Topic is not starred, star it
                            currentStarred.push(topic.name);
                        }
                        setStarredTopics(currentStarred);
                        // Re-render topics to apply sorting based on new starred state
                        renderAllContent(); // Re-render all content to re-sort topics
                    });

                    // Event listener for the main button area (for navigation)
                    button.addEventListener('click', () => {
                        window.location.href = topic.htmlFileName;
                    });

                    button.appendChild(topicNameSpan);
                    button.appendChild(starIcon);
                    topicsListDiv.appendChild(button);
                });
            }
        }

        /**
         * Renders the Action Prompts, Roll the Dice, and Import Questions buttons
         * WITHOUT any starring capability.
         */
        function renderActionButtons() {
            actionButtonsContainer.innerHTML = ''; // Clear existing buttons

            const actionButtonsData = [
                // {
                //     name: "Action Prompts",
                //     htmlFileName: "pages/action-prompts.html"
                // },
                // {
                //     name: "Roll the Dice",
                //     htmlFileName: "pages/dice.html"
                // },
                // {
                //     name: "Saved Items",
                //     htmlFileName: "pages/saved-items.html"
                // },
                {
                    name: "Import Questions",
                    htmlFileName: "pages/custom-questions-input.html"
                }
            ];

            // Alphabetical order
            actionButtonsData.sort((a, b) => a.name.localeCompare(b.name));

            // Determine starred actions; starred ones must appear above all topics.
            const starredActions = getStarredActions();
            const isStarredAction = name => starredActions.includes(name);

            // We'll create buttons; starred ones will be inserted above topics elsewhere.
            const createActionButton = (buttonData, starred) => {
                const button = document.createElement('button');
                button.classList.add('action-button');
                button.id = buttonData.name.toLowerCase().replace(/ /g, '-') + '-button';

                const buttonNameSpan = document.createElement('span');
                buttonNameSpan.textContent = buttonData.name;
                buttonNameSpan.style.pointerEvents = 'none';

                // Add star icon for these action buttons
                const starIcon = document.createElement('i');
                starIcon.classList.add('star-icon', 'fa-star');
                updateStarIcon(starIcon, starred);

                starIcon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleActionStar(buttonData.name);
                    renderAllContent(); // re-render to reposition
                });

                button.appendChild(buttonNameSpan);
                button.appendChild(starIcon);

                button.addEventListener('click', () => {
                    window.location.href = buttonData.htmlFileName;
                });

                return button;
            };

            // Build buttons and append only unstarred to the container (keep starred for top insertion)
            const unstarredButtons = actionButtonsData
                .filter(a => !isStarredAction(a.name))
                .map(a => createActionButton(a, false));
            unstarredButtons.forEach(btn => actionButtonsContainer.appendChild(btn));

            // Store starred buttons for injection above topics
            const starredButtons = actionButtonsData
                .filter(a => isStarredAction(a.name))
                .sort((a, b) => a.name.localeCompare(b.name))
                .map(a => createActionButton(a, true));

            // Inject starred action buttons above ALL topics and even above All in One
            // Place them just before the topics-list element.
            const parentContainer = document.querySelector('.bg-white.rounded-lg.shadow-xl.p-8.w-full.max-w-md.transition-transform');
            const topicsAnchor = document.getElementById('topics-list');

            // Remove previously injected starred action buttons if any
            document.querySelectorAll('[data-injected-starred-action="1"]').forEach(el => el.remove());

            starredButtons.forEach(btn => {
                btn.setAttribute('data-injected-starred-action', '1');
                parentContainer.insertBefore(btn, topicsAnchor);
            });

            // Ensure consistent spacing between the last injected action and the first topic
            // If we injected any starred actions, add a top margin to topics equal to space-y-4 (1rem)
            if (starredButtons.length > 0) {
                topicsAnchor.classList.add('has-starred-actions-above');
            } else {
                topicsAnchor.classList.remove('has-starred-actions-above');
            }
        }

        /**
         * Fetches quotes from famous-quotes.txt and displays a random one, utilizing localStorage caching.
         */
        async function fetchAndDisplayQuoteOfDay() {
            let quotesText = localStorage.getItem(quotesLocalStorageKey);

            if (!quotesText) {
                console.log("Fetching quotes from network and caching...");
                try {
                    const response = await fetch(quotesTxtUrl);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    quotesText = await response.text();
                    localStorage.setItem(quotesLocalStorageKey, quotesText); // Cache the fetched quotes
                } catch (error) {
                    console.error("Error fetching quotes of the day:", error);
                    quoteDisplay.textContent = "Failed to load quote.";
                    quoteAuthor.textContent = "";
                    return; // Exit if fetch fails
                }
            } else {
                console.log("Loading quotes from localStorage cache.");
            }

            try {
                const quotes = quotesText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

                if (quotes.length > 0) {
                    const randomIndex = Math.floor(Math.random() * quotes.length);
                    const selectedQuote = quotes[randomIndex];
                    
                    const parts = selectedQuote.split('--');
                    let quoteText = parts[0].trim();
                    let authorText = parts.length > 1 ? `-- ${parts[1].trim()}` : '';

                    quoteDisplay.textContent = quoteText;
                    quoteAuthor.textContent = authorText;
                } else {
                    quoteDisplay.textContent = "No quotes available.";
                    quoteAuthor.textContent = "";
                }
            } catch (parseError) {
                console.error("Error parsing quotes:", parseError);
                quoteDisplay.textContent = "Failed to parse quotes.";
                quoteAuthor.textContent = "";
                // Optionally, clear invalid cache if parsing fails
                localStorage.removeItem(quotesLocalStorageKey); 
            }
        }

        /**
         * Renders all dynamic content on the page (topics and action buttons) and applies filtering.
         */
        async function renderAllContent() {
            allButtons = []; // Clear the global list of buttons

            // Render Live Discussion button if applicable
            let liveDiscussionButtonElement = document.getElementById('live-discussion-button');
            if (liveDiscussionButtonElement && !liveDiscussionButtonContainer.classList.contains('hidden')) {
                allButtons.push(liveDiscussionButtonElement);
            }

            await fetchAndCacheTopics(); // This populates topicsListDiv and adds topic buttons to allButtons

            // Render action buttons with starring, ensuring starred actions get injected above topics
            renderActionButtons(); // This populates actionButtonsContainer and injects starred actions above topics

            // After all buttons are rendered, collect them into allButtons for filtering
            allButtons = []
                // Starred action buttons injected above topics (always on top, even above All in One)
                .concat(Array.from(document.querySelectorAll('[data-injected-starred-action="1"]')))
                // Topic buttons
                .concat(Array.from(topicsListDiv.querySelectorAll('.topic-button')))
                // Unstarred action buttons in their container
                .concat(Array.from(actionButtonsContainer.querySelectorAll('.action-button')))
                // Live discussion (if visible)
                .concat(liveDiscussionButtonElement && !liveDiscussionButtonContainer.classList.contains('hidden') ? [liveDiscussionButtonElement] : []);
            
            filterButtons(); // Apply current filter to all rendered buttons
        }

        // Copy Link Button Logic (now a text link)
        const copyLinkTextLink = document.getElementById('copy-link-text-link'); // Changed ID
        copyLinkTextLink.addEventListener('click', function(event) { // Changed to button
            event.preventDefault(); // Prevent default link behavior
            // Use a temporary textarea to copy the fixed URL to clipboard
            const tempInput = document.createElement('textarea');
            tempInput.value = "https://curioussoulscafe.github.io"; // Fixed URL
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert("Link copied to clipboard!");
        });

        // Share Link Button Logic (Web Share API only; no fallback)
        const shareLinkButton = document.getElementById('share-link-button');
        shareLinkButton.addEventListener('click', async (event) => {
            event.preventDefault();
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Curious Souls Café',
                        text: 'Join me at Curious Souls Café!',
                        url: 'https://curioussoulscafe.github.io'
                    });
                } catch (err) {
                    // Swallow errors silently as requested (no fallback)
                    console.warn('Share canceled or failed:', err);
                }
            }
            // If navigator.share is not available, do nothing (no fallback)
        });

        // Initial load
        fetchAndDisplayQuoteOfDay();
        renderAllContent(); // Call the new main rendering function

        // Add event listener for the search bar
        const filterButtonsDebounced = () => filterButtons();
        searchBar.addEventListener('input', filterButtonsDebounced);

        // Add event listeners for category filter buttons (single selection logic)
        const categoryButtons = document.querySelectorAll('#category-filter .filter-btn');
        categoryButtons.forEach(button => {
            button.addEventListener('click', () => {
                const filter = button.dataset.filter;
                const isAlreadyActive = button.classList.contains('active');

                // First, remove active class from all buttons
                categoryButtons.forEach(btn => btn.classList.remove('active'));

                if (isAlreadyActive) {
                    // If it was already active, we are turning it off (clearing the filter).
                    activeCategoryFilter = null;
                } else {
                    // If it was not active, turn it on and set the filter.
                    activeCategoryFilter = filter;
                    button.classList.add('active');
                }
                
                // Re-run the main filtering logic
                filterButtons();
            });
        });

        // Utility: Detect iOS and in Safari
        function isIOS() {
            return /iphone|ipad|ipod/i.test(window.navigator.userAgent);
        }
        function isSafari() {
            return /^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);
        }
        function isInStandaloneMode() {
            return (window.navigator.standalone === true) || window.matchMedia('(display-mode: standalone)').matches;
        }
        function isAndroid() {
            return /android/i.test(window.navigator.userAgent);
        }

        /* Keep the sticky search input above floating UI elements when typing on mobile */
        // Raise the sticky bar z-index temporarily on focus to avoid any overlap by chance.
        searchBar.addEventListener('focus', () => {
            const stickyWrap = document.querySelector('.sticky-search-container');
            if (stickyWrap) stickyWrap.style.zIndex = '4200';
        });
        searchBar.addEventListener('blur', () => {
            const stickyWrap = document.querySelector('.sticky-search-container');
            if (stickyWrap) stickyWrap.style.zIndex = '3200';
        });

        // Add to Homescreen logic
        let deferredPrompt;
        const btn = document.getElementById('add-to-homescreen-btn');
        const iosModal = document.getElementById('ios-modal-overlay');
        const closeIosModalBtn = iosModal.querySelector('.close-modal');

        window.addEventListener('beforeinstallprompt', (e) => {
            // For Chrome/Android PWA
            e.preventDefault();
            deferredPrompt = e;
            if (!isInStandaloneMode()) {
                btn.classList.add('show');
            }
        });

        btn.addEventListener('click', async function() {
            if (isIOS() && isSafari() && !isInStandaloneMode()) {
                // Show iOS instructions modal
                iosModal.classList.add('show');
            } else if (deferredPrompt) {
                // Show Chrome/Android PWA native prompt
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                btn.classList.remove('show');
            } else {
                // Fallback: instructions
                alert('To add this app to your homescreen, use your browser menu and select "Add to Home".');
            }
        });

        closeIosModalBtn.addEventListener('click', () => {
            iosModal.classList.remove('show');
            localStorage.setItem('csc_ios_modal_dismissed', '1');
        });

        // Show the button proactively for iOS Safari
        document.addEventListener('DOMContentLoaded', function() {
            if (
                isIOS() && isSafari() && !isInStandaloneMode() &&
                !localStorage.getItem('csc_ios_modal_dismissed')
            ) {
                btn.classList.add('show');
            }
        });

        // Hide the button if already installed
        if (isInStandaloneMode()) {
            btn.classList.remove('show');
        }

        // Dismiss modal and remember
        closeIosModalBtn.addEventListener('click', () => {
            iosModal.classList.remove('show');
            localStorage.setItem('csc_ios_modal_dismissed', '1');
        });

        // Optional: Hide button if installed via event
        window.addEventListener('appinstalled', () => {
            btn.classList.remove('show');
        });

        function updateInstallButtonText() {
            const btn = document.getElementById('add-to-homescreen-btn');
            if (isIOS() && isSafari() && !isInStandaloneMode()) {
                btn.innerHTML = '<i class="fa-solid fa-house-medical-circle-check mr-2"></i>Add to Home';
            } else if (isAndroid() && !isInStandaloneMode()) {
                btn.innerHTML = '<i class="fa-solid fa-house-medical-circle-check mr-2"></i>Add to Home';
            } else {
                // Default to desktop wording
                btn.innerHTML = '<i class="fa-solid fa-download mr-2"></i>Install App';
            }
        }

        function shouldShowInstallButton() {
            // Your existing logic for whether the button should be shown
            return btn.classList.contains('show');
        }

        function updateInstallButtonVisibility() {
            if (!shouldShowInstallButton()) return; // Don't show if not active anyway

            // How close to bottom before hiding? (px)
            const buffer = 120;
            const scrollY = window.scrollY || window.pageYOffset;
            const visibleHeight = window.innerHeight || document.documentElement.clientHeight;
            const fullHeight = document.documentElement.scrollHeight;

            // How far from bottom?
            const distanceFromBottom = fullHeight - (scrollY + visibleHeight);
            if (distanceFromBottom < buffer) {
                btn.style.display = 'none'; // Hide when near bottom
            } else {
                btn.style.display = 'block'; // Show otherwise
            }
        }

        // Re-check on scroll, resize, and page load
        window.addEventListener('scroll', updateInstallButtonVisibility);
        window.addEventListener('resize', updateInstallButtonVisibility);
        window.addEventListener('DOMContentLoaded', updateInstallButtonVisibility);

        // If you ever show/hide the button class in other logic, also call updateInstallButtonVisibility after that.

        // Call after DOMContentLoaded
        document.addEventListener('DOMContentLoaded', updateInstallButtonText);
        
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
            .then(reg => console.log('Service Worker registered', reg))
            .catch(err => console.warn('Service Worker registration failed:', err));
        }

        // Feedback modal wiring
        const openFeedbackModalBtn = document.getElementById('open-feedback-modal');
        const feedbackModalOverlay = document.getElementById('feedback-modal-overlay');
        const closeFeedbackModalBtn = document.getElementById('close-feedback-modal');
        function openFeedbackModal() { feedbackModalOverlay.classList.add('show'); }
        function closeFeedbackModal() { feedbackModalOverlay.classList.remove('show'); }
        openFeedbackModalBtn.addEventListener('click', openFeedbackModal);
        closeFeedbackModalBtn.addEventListener('click', closeFeedbackModal);
        feedbackModalOverlay.addEventListener('click', (e) => { if (e.target === feedbackModalOverlay) closeFeedbackModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && feedbackModalOverlay.classList.contains('show')) closeFeedbackModal(); });

        // NEW: Wire up "Share this app with others" inside feedback modal (same behavior as other share button)
        const shareAppFromFeedbackBtn = document.getElementById('share-app-from-feedback');
        if (shareAppFromFeedbackBtn) {
            shareAppFromFeedbackBtn.addEventListener('click', async () => {
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'Curious Souls Café',
                            text: 'Join me at Curious Souls Café!',
                            url: 'https://curioussoulscafe.github.io'
                        });
                    } catch (err) {
                        console.warn('Share canceled or failed:', err);
                    }
                }
                // Close the modal regardless (keeps UX tidy and mirrors silent behavior)
                closeFeedbackModal();
            });
        }

        // NEW: Events selector modal wiring
        const openEventsSelectorBtn = document.getElementById('open-events-selector');
        const eventsSelectorModal = document.getElementById('events-selector-modal');
        const closeEventsSelectorBtn = document.getElementById('close-events-selector');
        function openEventsSelector() { eventsSelectorModal.classList.add('show'); }
        function closeEventsSelector() { eventsSelectorModal.classList.remove('show'); }
        openEventsSelectorBtn.addEventListener('click', () => {
            // Close the feedback modal first for a clean stacked modal experience
            closeFeedbackModal();
            openEventsSelector();
        });
        closeEventsSelectorBtn.addEventListener('click', closeEventsSelector);
        eventsSelectorModal.addEventListener('click', (e) => { if (e.target === eventsSelectorModal) closeEventsSelector(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && eventsSelectorModal.classList.contains('show')) closeEventsSelector(); });

        // Modal: blog selector (Home, Events, About)
        const openBlogModalBtn = document.getElementById('open-blog-modal');
        const blogModalOverlay = document.getElementById('blog-modal-overlay');
        const closeBlogModalBtn = document.getElementById('close-blog-modal');

        function openBlogModal() { blogModalOverlay.classList.add('show'); }
        function closeBlogModal() { blogModalOverlay.classList.remove('show'); }

        openBlogModalBtn.addEventListener('click', openBlogModal);
        closeBlogModalBtn.addEventListener('click', closeBlogModal);
        blogModalOverlay.addEventListener('click', (e) => {
            if (e.target === blogModalOverlay) closeBlogModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && blogModalOverlay.classList.contains('show')) {
                closeBlogModal();
            }
        });

        // NEW: Modal wiring for Guide
        // We keep the original "Guide" anchor visible, but also allow opening the modal via long-press or future use.
        // If you prefer replacing the link with a modal button, swap the anchor for a button and wire it here.
        // For now, we auto-bind if an element with id 'open-guide-modal' exists.
        const openGuideModalBtn = document.getElementById('open-guide-modal');
        const guideModalOverlay = document.getElementById('guide-modal-overlay');
        const closeGuideModalBtn = document.getElementById('close-guide-modal');

        function openGuideModal() { guideModalOverlay.classList.add('show'); }
        function closeGuideModal() { guideModalOverlay.classList.remove('show'); }

        if (openGuideModalBtn) {
            openGuideModalBtn.addEventListener('click', openGuideModal);
        }
        closeGuideModalBtn.addEventListener('click', closeGuideModal);
        guideModalOverlay.addEventListener('click', (e) => {
            if (e.target === guideModalOverlay) closeGuideModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && guideModalOverlay.classList.contains('show')) {
                closeGuideModal();
            }
        });

        // NEW: Getting Started modal wiring (ported from Code A, adapted)
        const openGettingStartedBtn = document.getElementById('open-getting-started');
        const gettingStartedModal = document.getElementById('getting-started-modal');
        const closeGettingStartedModalBtn = document.getElementById('close-getting-started-modal');

        openGettingStartedBtn.addEventListener('click', () => {
            gettingStartedModal.classList.add('show');
        });
        closeGettingStartedModalBtn.addEventListener('click', () => {
            gettingStartedModal.classList.remove('show');
        });
        gettingStartedModal.addEventListener('click', (e) => {
            if (e.target === gettingStartedModal) gettingStartedModal.classList.remove('show');
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && gettingStartedModal.classList.contains('show')) {
                gettingStartedModal.classList.remove('show');
            }
        });

        // NEW: QR Code modal logic (adapted for main page)
        const qrCodeModal = document.getElementById('qr-code-modal');
        const qrModalCloseButton = document.getElementById('qr-modal-close-button');
        const inlineShareTrigger = document.getElementById('inline-share-trigger');
        const qrModalImage = document.getElementById('qr-modal-image');
        const qrLinkAnchor = document.getElementById('qr-link-anchor');

        // Track whether Share was opened from Getting Started modal to restore it on close
        let shouldReturnToGettingStarted = false;

        function openShareModal(openedFromGettingStarted = false) {
            shouldReturnToGettingStarted = openedFromGettingStarted;
            const pageUrl = 'https://curioussoulscafe.github.io';
            const qrCodeApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(pageUrl)}`;
            qrModalImage.src = qrCodeApiUrl;
            qrLinkAnchor.href = pageUrl;
            qrLinkAnchor.textContent = pageUrl;
            qrCodeModal.classList.add('show');
        }

        function closeShareModal() {
            qrCodeModal.classList.remove('show');
            if (shouldReturnToGettingStarted) {
                gettingStartedModal.classList.add('show');
            }
            shouldReturnToGettingStarted = false;
        }

        // Open from inline link in Getting Started modal
        inlineShareTrigger.addEventListener('click', (e) => {
            e.preventDefault();
            gettingStartedModal.classList.remove('show');
            openShareModal(true);
        });

        // Close handlers
        qrModalCloseButton.addEventListener('click', closeShareModal);
        qrCodeModal.addEventListener('click', (e) => {
            if (e.target === qrCodeModal) closeShareModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && qrCodeModal.classList.contains('show')) {
                closeShareModal();
            }
        });

        // Copy/Share inside QR modal (Web Share API only; no fallback)
        const copyLinkTextLinkQr = document.getElementById('copy-link-text-link-qr');
        const shareLinkButtonQr = document.getElementById('share-link-button-qr');

        copyLinkTextLinkQr.addEventListener('click', (event) => {
            event.preventDefault();
            const pageUrl = 'https://curioussoulscafe.github.io';
            const tempInput = document.createElement('textarea');
            tempInput.value = pageUrl;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert("Link copied to clipboard!");
        });

        shareLinkButtonQr.addEventListener('click', async (event) => {
            event.preventDefault();
            const pageUrl = 'https://curioussoulscafe.github.io';
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Curious Souls Café',
                        text: 'Join me at Curious Souls Café!',
                        url: pageUrl
                    });
                } catch (err) {
                    console.warn('Share canceled or failed:', err);
                }
            }
            // If navigator.share is not available, do nothing
        });

    </script>    
</body>
</html>